# å³°é¢ç§¯å·¥å…· - åŸºçº¿æ¨¡å¼æ€§èƒ½å¯¹æ¯”åˆ†æ

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæµç¨‹å¯¹æ¯”](#æ‰§è¡Œæµç¨‹å¯¹æ¯”)
2. [ç®—æ³•å¤æ‚åº¦åˆ†æ](#ç®—æ³•å¤æ‚åº¦åˆ†æ)
3. [æ€§èƒ½é‡åŒ–æŒ‡æ ‡](#æ€§èƒ½é‡åŒ–æŒ‡æ ‡)
4. [ä¼˜åŒ–å‰åå¯¹æ¯”](#ä¼˜åŒ–å‰åå¯¹æ¯”)
5. [ä¸ºä»€ä¹ˆä¸¤ç‚¹åŸºçº¿æ›´å¿«](#ä¸ºä»€ä¹ˆä¸¤ç‚¹åŸºçº¿æ›´å¿«)

---

## ğŸ”„ æ‰§è¡Œæµç¨‹å¯¹æ¯”

### å®Œæ•´è°ƒç”¨é“¾

```
ç”¨æˆ·æ‹–åŠ¨ç«¯ç‚¹
  â†“
mouseMoveEvent()                    [æ‹–åŠ¨100px = 100æ¬¡è°ƒç”¨]
  â†“
markDirty() + update()              [100æ¬¡è°ƒç”¨ï¼Œä½† Qt åˆå¹¶ä¸º 10-20æ¬¡å®é™…é‡ç»˜]
  â†“
paint()                             [10-20æ¬¡è°ƒç”¨]
  â†“
updateCache()                       [10-20æ¬¡è°ƒç”¨]
  â†“
â”œâ”€ calculateArea()                  [10-20æ¬¡è°ƒç”¨]
â”‚  â”œâ”€ éå† ~3000 ä¸ªæ•°æ®ç‚¹         [30,000-60,000 æ¬¡è¿­ä»£]
â”‚  â””â”€ æ¯ä¸ªæ•°æ®ç‚¹è°ƒç”¨ getBaselineValue() Ã— 2
â”‚     = 60,000-120,000 æ¬¡è°ƒç”¨
â”‚
â””â”€ buildAreaPolygon()               [10-20æ¬¡è°ƒç”¨]
   â”œâ”€ éå† ~3000 ä¸ªæ•°æ®ç‚¹         [30,000-60,000 æ¬¡è¿­ä»£]
   â””â”€ æ¯ä¸ªæ•°æ®ç‚¹è°ƒç”¨ getBaselineValue() Ã— 1
      = 30,000-60,000 æ¬¡è°ƒç”¨

æ€»è®¡ getBaselineValue() è°ƒç”¨æ¬¡æ•°ï¼š90,000-180,000 æ¬¡
```

### ä¼˜åŒ–å‰çš„è°ƒç”¨é“¾ï¼ˆâŒ å·²ä¿®å¤ï¼‰

```
mouseMoveEvent()                    [100æ¬¡]
  â†“
ç›´æ¥è°ƒç”¨ calculateArea()           [100æ¬¡]
ç›´æ¥è°ƒç”¨ buildAreaPolygon()        [100æ¬¡]
  â†“
getBaselineValue() è°ƒç”¨ï¼š
  calculateArea:        100 Ã— 3000 Ã— 2 = 600,000 æ¬¡
  buildAreaPolygon:     100 Ã— 3000 Ã— 1 = 300,000 æ¬¡
  æ€»è®¡ï¼š                              900,000 æ¬¡ âŒ
```

---

## ğŸ“Š ç®—æ³•å¤æ‚åº¦åˆ†æ

### 1. Linear åŸºçº¿ï¼ˆä¸¤ç‚¹åŸºçº¿ï¼‰

**ä»£ç ä½ç½®**: `peak_area_tool.cpp:469-483`

```cpp
case BaselineMode::Linear: {
    // 1. è¯»å–ç«¯ç‚¹åæ ‡ï¼ˆä»æˆå‘˜å˜é‡ï¼‰
    double x1 = m_useTimeAxis ? m_point1.time : m_point1.temperature;  // O(1)
    double x2 = m_useTimeAxis ? m_point2.time : m_point2.temperature;  // O(1)
    double y1 = m_point1.value;                                         // O(1)
    double y2 = m_point2.value;                                         // O(1)

    // 2. é™¤é›¶æ£€æŸ¥
    if (qAbs(x2 - x1) < 1e-9) {
        return y1;  // O(1)
    }

    // 3. çº¿æ€§æ’å€¼è®¡ç®—
    double ratio = (xValue - x1) / (x2 - x1);  // O(1)
    return y1 + ratio * (y2 - y1);            // O(1)
}
```

**å¤æ‚åº¦**:
- **æ—¶é—´å¤æ‚åº¦**: O(1) - å¸¸æ•°æ—¶é—´
- **æ“ä½œæ¬¡æ•°**: 4-6 æ¬¡ç®—æœ¯è¿ç®—
- **å†…å­˜è®¿é—®**: 4 æ¬¡æˆå‘˜å˜é‡è¯»å–
- **æ— é¢å¤–å¼€é”€**: æ— å¾ªç¯ã€æ— å‡½æ•°è°ƒç”¨ã€æ— å†…å­˜åˆ†é…

---

### 2. ReferenceCurve åŸºçº¿ï¼ˆå‚è€ƒåŸºçº¿ï¼‰

**ä»£ç ä½ç½®**: `peak_area_tool.cpp:485-557`

#### é˜¶æ®µ1ï¼šç¼“å­˜éªŒè¯ï¼ˆå‡æ‘Š O(1)ï¼‰

```cpp
// 1. æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
if (m_cachedBaselineCurveId != m_baselineCurveId || m_cachedBaselineData.isEmpty()) {
    // ç¼“å­˜å¤±æ•ˆï¼Œé‡æ–°åŠ è½½åŸºçº¿æ•°æ®ï¼ˆä»…åœ¨é¦–æ¬¡æˆ–åˆ‡æ¢æ›²çº¿æ—¶æ‰§è¡Œï¼‰
    ThermalCurve* baseline = m_curveManager->getCurve(m_baselineCurveId);
    m_cachedBaselineData = baseline->getProcessedData();  // å¤åˆ¶ ~3000 ç‚¹
    m_cachedBaselineCurveId = m_baselineCurveId;
}
```

**å¼€é”€**:
- é¦–æ¬¡è°ƒç”¨: O(n) - å¤åˆ¶ 3000 ä¸ªæ•°æ®ç‚¹
- åç»­è°ƒç”¨: O(1) - ä»…å­—ç¬¦ä¸²æ¯”è¾ƒå’Œå¸ƒå°”æ£€æŸ¥
- **å‡æ‘Šå¤æ‚åº¦**: O(1)

#### é˜¶æ®µ2ï¼šäºŒåˆ†æŸ¥æ‰¾ï¼ˆO(log n)ï¼‰

```cpp
// 2. äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ° xValue æ‰€åœ¨çš„åŒºé—´ [left, right]
int left = 0;
int right = data.size() - 1;  // 3000

// è¾¹ç•Œæ£€æŸ¥
if (xValue <= firstX) return data[left].value;   // O(1)
if (xValue >= lastX) return data[right].value;   // O(1)

// äºŒåˆ†æŸ¥æ‰¾æ ¸å¿ƒå¾ªç¯
while (right - left > 1) {  // æœ€å¤š logâ‚‚(3000) â‰ˆ 12 æ¬¡è¿­ä»£
    int mid = left + (right - left) / 2;
    double midX = m_useTimeAxis ? data[mid].time : data[mid].temperature;

    if (xValue < midX) {
        right = mid;
    } else {
        left = mid;
    }
}
```

**è¿­ä»£æ¬¡æ•°åˆ†æ**:
- n = 3000 â†’ logâ‚‚(3000) â‰ˆ 11.55 â†’ **12 æ¬¡è¿­ä»£**
- æ¯æ¬¡è¿­ä»£: 3 æ¬¡ç®—æœ¯è¿ç®— + 1 æ¬¡æ¯”è¾ƒ + 1 æ¬¡æ•°ç»„è®¿é—®
- **æ€»æ“ä½œæ•°**: 12 Ã— 5 = **60 æ¬¡æ“ä½œ**

#### é˜¶æ®µ3ï¼šçº¿æ€§æ’å€¼ï¼ˆO(1)ï¼‰

```cpp
// 3. çº¿æ€§æ’å€¼ï¼ˆleft å’Œ right æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªç‚¹ï¼‰
double x0 = m_useTimeAxis ? data[left].time : data[left].temperature;
double x1 = m_useTimeAxis ? data[right].time : data[right].temperature;
double y0 = data[left].value;
double y1 = data[right].value;

if (qAbs(x1 - x0) < 1e-9) {
    return y0;  // é¿å…é™¤é›¶
}

double ratio = (xValue - x0) / (x1 - x0);
return y0 + ratio * (y1 - y0);
```

**æ“ä½œæ•°**: 6 æ¬¡ç®—æœ¯è¿ç®— + 4 æ¬¡æ•°ç»„è®¿é—® = 10 æ¬¡æ“ä½œ

**æ€»å¤æ‚åº¦**: O(1) + O(log n) + O(1) = **O(log n)**

---

## ğŸ“ˆ æ€§èƒ½é‡åŒ–æŒ‡æ ‡

### æµ‹è¯•åœºæ™¯

å‡è®¾ä¸€æ¡å…¸å‹çš„ TGA æ›²çº¿ï¼š
- **æ•°æ®ç‚¹æ•°**: 3000 ç‚¹
- **æ‹–åŠ¨è·ç¦»**: 100 åƒç´ 
- **Qt æ›´æ–°åˆå¹¶**: 100 æ¬¡ mouseMoveEvent â†’ 15 æ¬¡ paint()

### Linear åŸºçº¿ï¼ˆä¸¤ç‚¹åŸºçº¿ï¼‰

| æŒ‡æ ‡ | æ•°å€¼ | è®¡ç®—å…¬å¼ |
|------|------|----------|
| **å•æ¬¡è°ƒç”¨æ“ä½œæ•°** | 6 | å›ºå®š |
| **calculateArea è°ƒç”¨æ¬¡æ•°** | 15 Ã— 3000 Ã— 2 = 90,000 | 15 æ¬¡ paint Ã— 3000 ç‚¹ Ã— 2 æ¬¡/ç‚¹ |
| **buildAreaPolygon è°ƒç”¨æ¬¡æ•°** | 15 Ã— 3000 = 45,000 | 15 æ¬¡ paint Ã— 3000 ç‚¹ |
| **æ€»å‡½æ•°è°ƒç”¨æ¬¡æ•°** | 135,000 | 90,000 + 45,000 |
| **æ€»æ“ä½œæ•°** | 135,000 Ã— 6 = **810,000** | 6 æ¬¡æ“ä½œ/è°ƒç”¨ |
| **é¢„ä¼°æ‰§è¡Œæ—¶é—´ï¼ˆ3.5 GHz CPUï¼‰** | 0.23 ms | 810,000 Ã· 3,500,000 |

### ReferenceCurve åŸºçº¿ï¼ˆå‚è€ƒåŸºçº¿ - ä¼˜åŒ–åï¼‰

| æŒ‡æ ‡ | æ•°å€¼ | è®¡ç®—å…¬å¼ |
|------|------|----------|
| **å•æ¬¡è°ƒç”¨æ“ä½œæ•°** | 70 | 12 æ¬¡äºŒåˆ†è¿­ä»£ Ã— 5 + 10 æ¬¡æ’å€¼ |
| **calculateArea è°ƒç”¨æ¬¡æ•°** | 15 Ã— 3000 Ã— 2 = 90,000 | 15 æ¬¡ paint Ã— 3000 ç‚¹ Ã— 2 æ¬¡/ç‚¹ |
| **buildAreaPolygon è°ƒç”¨æ¬¡æ•°** | 15 Ã— 3000 = 45,000 | 15 æ¬¡ paint Ã— 3000 ç‚¹ |
| **æ€»å‡½æ•°è°ƒç”¨æ¬¡æ•°** | 135,000 | 90,000 + 45,000 |
| **æ€»æ“ä½œæ•°** | 135,000 Ã— 70 = **9,450,000** | 70 æ¬¡æ“ä½œ/è°ƒç”¨ |
| **é¢„ä¼°æ‰§è¡Œæ—¶é—´ï¼ˆ3.5 GHz CPUï¼‰** | 2.7 ms | 9,450,000 Ã· 3,500,000 |

### æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Linear | ReferenceCurve | å€ç‡ |
|------|--------|----------------|------|
| **å•æ¬¡è°ƒç”¨å¼€é”€** | 6 æ¬¡æ“ä½œ | 70 æ¬¡æ“ä½œ | **11.7x** |
| **æ€»æ“ä½œæ•°** | 810,000 | 9,450,000 | **11.7x** |
| **é¢„ä¼°æ‰§è¡Œæ—¶é—´** | 0.23 ms | 2.7 ms | **11.7x** |

**ç»“è®º**: å³ä½¿ç»è¿‡ä¼˜åŒ–ï¼ŒReferenceCurve æ¨¡å¼ä»ç„¶æ¯” Linear æ¨¡å¼æ…¢ **11.7 å€**ï¼Œè¿™æ˜¯ç®—æ³•æœ¬è´¨å†³å®šçš„ï¼ˆO(1) vs O(log n)ï¼‰ã€‚

---

## ğŸ”§ ä¼˜åŒ–å‰åå¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆv0 - çº¿æ€§æœç´¢ï¼‰

```cpp
// âŒ æ—§ä»£ç ï¼šçº¿æ€§æœç´¢ O(n)
for (int i = 0; i < data.size() - 1; ++i) {
    double x1 = data[i].temperature;
    double x2 = data[i + 1].temperature;
    if (xValue >= x1 && xValue <= x2) {
        // æ‰¾åˆ°åŒºé—´ï¼Œè¿›è¡Œæ’å€¼
        return ...;
    }
}
```

**æ€§èƒ½æŒ‡æ ‡**:
- **æœ€åæƒ…å†µ**: éå† 3000 ç‚¹ â†’ 3000 æ¬¡è¿­ä»£
- **å¹³å‡æƒ…å†µ**: éå† 1500 ç‚¹ â†’ 1500 æ¬¡è¿­ä»£
- **å•æ¬¡è°ƒç”¨æ“ä½œæ•°**: ~4500 æ¬¡
- **æ‹–åŠ¨æ—¶æ€»æ“ä½œæ•°**: 135,000 Ã— 4500 = **607,500,000 æ¬¡** âŒ
- **é¢„ä¼°æ‰§è¡Œæ—¶é—´**: 174 msï¼ˆä¸å¯æ¥å—ï¼‰

### ä¼˜åŒ– v1ï¼ˆäºŒåˆ†æŸ¥æ‰¾ + ç›´æ¥è®¡ç®—ï¼‰

```cpp
// âœ… ä¼˜åŒ– v1ï¼šäºŒåˆ†æŸ¥æ‰¾ O(log n)
while (right - left > 1) {
    int mid = left + (right - left) / 2;
    if (xValue < data[mid].temperature) {
        right = mid;
    } else {
        left = mid;
    }
}

// ä½†ä»ç„¶åœ¨ mouseMoveEvent() ä¸­ç›´æ¥è°ƒç”¨ï¼š
void mouseMoveEvent() {
    m_point1 = snappedPoint;
    qreal newArea = calculateArea();        // âŒ 100æ¬¡ç›´æ¥è°ƒç”¨
    m_cachedPolygon = buildAreaPolygon();   // âŒ 100æ¬¡ç›´æ¥è°ƒç”¨
    update();
}
```

**æ€§èƒ½æŒ‡æ ‡**:
- **å•æ¬¡è°ƒç”¨æ“ä½œæ•°**: 70 æ¬¡ï¼ˆäºŒåˆ† + æ’å€¼ï¼‰
- **å‡½æ•°è°ƒç”¨æ¬¡æ•°**: 100 Ã— 3000 Ã— 3 = 900,000 æ¬¡ï¼ˆç›´æ¥è°ƒç”¨ï¼‰
- **æ€»æ“ä½œæ•°**: 900,000 Ã— 70 = **63,000,000 æ¬¡**
- **é¢„ä¼°æ‰§è¡Œæ—¶é—´**: 18 msï¼ˆä»ç„¶å¡é¡¿ï¼‰

### ä¼˜åŒ– v2ï¼ˆå»¶è¿Ÿè®¡ç®— + äºŒåˆ†æŸ¥æ‰¾ï¼‰âœ… å½“å‰ç‰ˆæœ¬

```cpp
// âœ… ä¼˜åŒ– v2ï¼šå»¶è¿Ÿè®¡ç®—æ¨¡å¼
void mouseMoveEvent() {
    m_point1 = snappedPoint;
    markDirty();  // ä»…æ ‡è®°ä¸ºè„
    update();     // Qt åˆå¹¶æ›´æ–°ï¼Œå‡å°‘å®é™…è®¡ç®—æ¬¡æ•°
}

void paint() {
    updateCache();  // ä»…åœ¨éœ€è¦é‡ç»˜æ—¶æ‰è®¡ç®—
}

void updateCache() {
    if (!m_isDirty) return;  // è·³è¿‡é‡å¤è®¡ç®—
    m_cachedArea = calculateArea();
    m_cachedPolygon = buildAreaPolygon();
    m_isDirty = false;
}
```

**æ€§èƒ½æŒ‡æ ‡**:
- **å•æ¬¡è°ƒç”¨æ“ä½œæ•°**: 70 æ¬¡ï¼ˆäºŒåˆ† + æ’å€¼ï¼‰
- **å‡½æ•°è°ƒç”¨æ¬¡æ•°**: 15 Ã— 3000 Ã— 3 = 135,000 æ¬¡ï¼ˆQt åˆå¹¶åï¼‰
- **æ€»æ“ä½œæ•°**: 135,000 Ã— 70 = **9,450,000 æ¬¡** âœ…
- **é¢„ä¼°æ‰§è¡Œæ—¶é—´**: 2.7 msï¼ˆæµç•…ï¼‰

### ä¸‰ç‰ˆæœ¬å¯¹æ¯”è¡¨

| ç‰ˆæœ¬ | ç®—æ³• | è°ƒç”¨ç­–ç•¥ | æ€»æ“ä½œæ•° | æ‰§è¡Œæ—¶é—´ | æ”¹è¿›å€ç‡ |
|------|------|----------|----------|----------|----------|
| **v0ï¼ˆåŸå§‹ï¼‰** | çº¿æ€§æœç´¢ O(n) | ç›´æ¥è°ƒç”¨ | 607,500,000 | 174 ms | åŸºå‡† |
| **v1ï¼ˆé¦–æ¬¡ä¼˜åŒ–ï¼‰** | äºŒåˆ†æŸ¥æ‰¾ O(log n) | ç›´æ¥è°ƒç”¨ | 63,000,000 | 18 ms | 9.6x âš¡ |
| **v2ï¼ˆå½“å‰ï¼‰** | äºŒåˆ†æŸ¥æ‰¾ O(log n) | å»¶è¿Ÿè®¡ç®— | 9,450,000 | 2.7 ms | 64x ğŸš€ |

---

## ğŸ¤” ä¸ºä»€ä¹ˆä¸¤ç‚¹åŸºçº¿æ›´å¿«ï¼Ÿ

### æ ¹æœ¬åŸå› ï¼šç®—æ³•å¤æ‚åº¦å·®å¼‚

| å¯¹æ¯”ç»´åº¦ | Linear åŸºçº¿ | ReferenceCurve åŸºçº¿ | å·®å¼‚ |
|----------|-------------|---------------------|------|
| **æ•°æ®æ¥æº** | æˆå‘˜å˜é‡ `m_point1`, `m_point2` | å¤–éƒ¨æ›²çº¿æ•°æ®ï¼ˆ3000ç‚¹ï¼‰ | æ•°æ®é‡çº§å·®å¼‚ |
| **æ•°æ®è®¿é—®** | 4 æ¬¡æˆå‘˜å˜é‡è¯»å– | 12 æ¬¡æ•°ç»„è®¿é—®ï¼ˆäºŒåˆ†æŸ¥æ‰¾ï¼‰ | 3x å†…å­˜è®¿é—® |
| **è®¡ç®—ç±»å‹** | çº¯ç®—æœ¯è¿ç®—ï¼ˆ4 æ¬¡ï¼‰ | å¾ªç¯ + æ¡ä»¶åˆ¤æ–­ + ç®—æœ¯ | æ§åˆ¶æµå¼€é”€ |
| **CPU æŒ‡ä»¤** | ~6 æ¡ | ~70 æ¡ | 11.7x æŒ‡ä»¤æ•° |
| **ç¼“å­˜å‹å¥½æ€§** | âœ… æ•°æ®åœ¨å¯„å­˜å™¨/L1ç¼“å­˜ | âš ï¸ æ•°ç»„è®¿é—®ï¼Œå¯èƒ½ç¼“å­˜æœªå‘½ä¸­ | å†…å­˜å»¶è¿Ÿ |

### è¯¦ç»†åˆ†æ

#### Linear åŸºçº¿çš„ä¼˜åŠ¿

```cpp
// æ‰€æœ‰æ•°æ®å·²åœ¨å†…å­˜ï¼ˆæˆå‘˜å˜é‡ï¼‰
double x1 = m_point1.temperature;  // CPU å¯„å­˜å™¨
double y1 = m_point1.value;        // CPU å¯„å­˜å™¨

// çº¯è®¡ç®—ï¼Œæ— åˆ†æ”¯é¢„æµ‹å¤±è´¥
double ratio = (xValue - x1) / (x2 - x1);  // 1 æ¬¡å‡æ³• + 1 æ¬¡é™¤æ³•
return y1 + ratio * (y2 - y1);             // 2 æ¬¡ä¹˜æ³• + 1 æ¬¡å‡æ³• + 1 æ¬¡åŠ æ³•
```

**CPU æ‰§è¡Œç‰¹æ€§**:
- âœ… æ‰€æœ‰æ“ä½œåœ¨ CPU å¯„å­˜å™¨ä¸­å®Œæˆ
- âœ… æ— å¾ªç¯ï¼Œåˆ†æ”¯é¢„æµ‹ 100% å‡†ç¡®
- âœ… æŒ‡ä»¤æµæ°´çº¿æ»¡è½½è¿è¡Œ
- âœ… å•æ¬¡è°ƒç”¨ < 10 ä¸ª CPU æ—¶é’Ÿå‘¨æœŸ

#### ReferenceCurve åŸºçº¿çš„æŒ‘æˆ˜

```cpp
// é˜¶æ®µ1ï¼šç¼“å­˜éªŒè¯ï¼ˆå¯èƒ½è§¦å‘å†…å­˜å¤åˆ¶ï¼‰
if (m_cachedBaselineData.isEmpty()) {
    m_cachedBaselineData = baseline->getProcessedData();  // å¤åˆ¶ 3000 ç‚¹ï¼ˆé¦–æ¬¡ï¼‰
}

// é˜¶æ®µ2ï¼šäºŒåˆ†æŸ¥æ‰¾ï¼ˆ12 æ¬¡å¾ªç¯è¿­ä»£ï¼‰
while (right - left > 1) {  // å¾ªç¯å¼€é”€ï¼šæ¡ä»¶åˆ¤æ–­ + è·³è½¬
    int mid = left + (right - left) / 2;  // ç®—æœ¯è¿ç®—
    double midX = data[mid].temperature;   // æ•°ç»„è®¿é—®ï¼ˆå¯èƒ½ç¼“å­˜æœªå‘½ä¸­ï¼‰

    if (xValue < midX) {  // åˆ†æ”¯é¢„æµ‹ï¼ˆå¯èƒ½å¤±è´¥ï¼‰
        right = mid;
    } else {
        left = mid;
    }
}

// é˜¶æ®µ3ï¼šæ’å€¼ï¼ˆä¸ Linear ç›¸åŒï¼Œä½†å·²ç´¯ç§¯å¼€é”€ï¼‰
```

**CPU æ‰§è¡Œç‰¹æ€§**:
- âš ï¸ æ•°ç»„è®¿é—®éœ€ä» L2/L3 ç¼“å­˜æˆ–å†…å­˜åŠ è½½ï¼ˆ~10-100 æ—¶é’Ÿå‘¨æœŸå»¶è¿Ÿï¼‰
- âš ï¸ å¾ªç¯å¯¼è‡´åˆ†æ”¯é¢„æµ‹å¤±è´¥ï¼ˆ~10-20 æ—¶é’Ÿå‘¨æœŸæƒ©ç½šï¼‰
- âš ï¸ æŒ‡ä»¤æµæ°´çº¿å¯èƒ½åœæ»ç­‰å¾…æ•°æ®
- âš ï¸ å•æ¬¡è°ƒç”¨ ~500-1000 ä¸ª CPU æ—¶é’Ÿå‘¨æœŸ

### ä¸å¯é€¾è¶Šçš„æ€§èƒ½å·®è·

å³ä½¿ä¼˜åŒ–åˆ°æè‡´ï¼ŒReferenceCurve åŸºçº¿ä¹Ÿæ— æ³•è¾¾åˆ° Linear åŸºçº¿çš„é€Ÿåº¦ï¼Œå› ä¸ºï¼š

1. **O(1) vs O(log n)**ï¼šç®—æ³•å¤æ‚åº¦çš„æœ¬è´¨å·®å¼‚
2. **æ•°æ®å±€éƒ¨æ€§**ï¼šæˆå‘˜å˜é‡ vs æ•°ç»„è®¿é—®
3. **æ§åˆ¶æµå¤æ‚åº¦**ï¼šæ— å¾ªç¯ vs å¾ªç¯ + åˆ†æ”¯
4. **CPU æµæ°´çº¿æ•ˆç‡**ï¼šç›´çº¿æ‰§è¡Œ vs å¯èƒ½çš„æµæ°´çº¿åœæ»

**æœ€ä½³ç»“æœ**ï¼šç»è¿‡ä¼˜åŒ–ï¼ŒReferenceCurve æ¨¡å¼çš„æ‹–åŠ¨æµç•…åº¦æ¥è¿‘ Linear æ¨¡å¼ï¼Œä½†ä»ä¼šæœ‰ **10-12 å€çš„æ€§èƒ½å·®è·**ï¼ˆ2.7 ms vs 0.23 msï¼‰ã€‚

---

## ğŸ“Š å¯è§†åŒ–å¯¹æ¯”

### è°ƒç”¨æ¬¡æ•°å¯¹æ¯”ï¼ˆæ‹–åŠ¨ 100pxï¼‰

```
Linear åŸºçº¿:
mouseMoveEvent [100] â†’ markDirty [100] â†’ paint [15] â†’ getBaselineValue [135,000]
æ€»è°ƒç”¨: 135,000 æ¬¡ Ã— 6 æ“ä½œ = 810,000 æ“ä½œ

ReferenceCurve åŸºçº¿:
mouseMoveEvent [100] â†’ markDirty [100] â†’ paint [15] â†’ getBaselineValue [135,000]
æ€»è°ƒç”¨: 135,000 æ¬¡ Ã— 70 æ“ä½œ = 9,450,000 æ“ä½œ

å·®è·: 11.7x
```

### æ‰§è¡Œæ—¶é—´å¯¹æ¯”ï¼ˆç›¸å¯¹æ¯”ä¾‹ï¼‰

```
Linear:        â–ˆâ–ˆâ–ˆâ–ˆ 0.23 ms
ReferenceCurve: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 2.7 ms

å·®è·: 11.7x
```

### ä¼˜åŒ–æ•ˆæœï¼ˆReferenceCurve æ¨¡å¼ï¼‰

```
v0 (çº¿æ€§æœç´¢):    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 174 ms âŒ
v1 (äºŒåˆ†æŸ¥æ‰¾):    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 18 ms âš¡
v2 (å»¶è¿Ÿè®¡ç®—):    â–ˆ 2.7 ms âœ…

æ”¹è¿›: 64x
```

---

## âœ… ç»“è®º

### æ ¸å¿ƒå‘ç°

1. **Linear åŸºçº¿çš„ä¼˜åŠ¿æ— å¯æ›¿ä»£**ï¼š
   - O(1) ç®—æ³•å¤æ‚åº¦
   - æ•°æ®å±€éƒ¨æ€§å¥½ï¼ˆCPU å¯„å­˜å™¨/L1 ç¼“å­˜ï¼‰
   - æ— æ§åˆ¶æµå¼€é”€

2. **ReferenceCurve åŸºçº¿çš„ç“¶é¢ˆ**ï¼š
   - O(log n) ç®—æ³•å¤æ‚åº¦ï¼ˆç†è®ºä¸‹é™ï¼‰
   - æ•°ç»„è®¿é—®å¼€é”€ï¼ˆå†…å­˜å»¶è¿Ÿï¼‰
   - å¾ªç¯å’Œåˆ†æ”¯é¢„æµ‹å¼€é”€

3. **ä¼˜åŒ–æ•ˆæœæ˜¾è‘—**ï¼š
   - ä» 174 ms ä¼˜åŒ–åˆ° 2.7 msï¼ˆ64 å€æ”¹è¿›ï¼‰
   - æ‹–åŠ¨æµç•…åº¦ä»"ä¸å¯ç”¨"æå‡åˆ°"æ¥è¿‘æµç•…"
   - ä½†ä»æ— æ³•å®Œå…¨åŒ¹é… Linear æ¨¡å¼çš„æ€§èƒ½

### æœ€ç»ˆå»ºè®®

1. **å¯¹äºå®æ—¶äº¤äº’åœºæ™¯**ï¼ˆæ‹–åŠ¨ã€ç¼©æ”¾ï¼‰ï¼š
   - ä¼˜å…ˆä½¿ç”¨ **Linear åŸºçº¿**ï¼ˆæœ€ä½³æ€§èƒ½ï¼‰
   - ReferenceCurve åŸºçº¿ç°å·²å¯ç”¨ï¼ˆä¼˜åŒ–åï¼‰

2. **å¯¹äºç²¾ç¡®åˆ†æåœºæ™¯**ï¼ˆæŠ¥å‘Šç”Ÿæˆã€æ•°æ®å¯¼å‡ºï¼‰ï¼š
   - ä½¿ç”¨ **ReferenceCurve åŸºçº¿**ï¼ˆæ›´å‡†ç¡®çš„åŸºçº¿æ‹Ÿåˆï¼‰
   - æ€§èƒ½å¼€é”€å¯æ¥å—ï¼ˆä¸€æ¬¡æ€§è®¡ç®—ï¼‰

3. **æœªæ¥ä¼˜åŒ–æ–¹å‘**ï¼š
   - âœ… å·²å®ç°ï¼šç¼“å­˜ + äºŒåˆ†æŸ¥æ‰¾ + å»¶è¿Ÿè®¡ç®—
   - ğŸ”® å¯èƒ½æ–¹å‘ï¼š
     - åŸºçº¿æ•°æ®é¢„æ’å€¼ï¼ˆç‰ºç‰²å†…å­˜æ¢æ—¶é—´ï¼‰
     - GPU åŠ é€Ÿï¼ˆå¯¹äºè¶…å¤§æ•°æ®é›†ï¼‰
     - SIMD å‘é‡åŒ–ä¼˜åŒ–ï¼ˆæ‰¹é‡è®¡ç®—ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-12
**æœ€åæ›´æ–°**: 2025-11-12
**ä¼˜åŒ–ç‰ˆæœ¬**: v2ï¼ˆå»¶è¿Ÿè®¡ç®— + äºŒåˆ†æŸ¥æ‰¾ï¼‰
