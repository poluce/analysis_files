graph TB
    subgraph 表示层["🖥️ 表示层 (Presentation Layer)"]
        direction TB
        MW[MainWindow<br/>主窗口]
        CV[ChartView<br/>图表视图]
        TP[ToolPanel<br/>工具面板]
        
        MW -.发出信号.-> MW_Signal[用户操作信号:<br/>openFileRequested<br/>saveProjectRequested<br/>undoRequested]
        CV -.发出信号.-> CV_Signal[交互信号:<br/>regionSelected<br/>pointClicked<br/>zoomChanged]
        TP -.发出信号.-> TP_Signal[参数设置信号:<br/>parameterChanged<br/>algorithmApplied]
    end
    
    subgraph 应用层["⚙️ 应用层 (Application Layer)"]
        direction TB
        
        subgraph Controllers["控制器 (Controllers)"]
            MC[MainController<br/>主控制器]
            CC[ChartController<br/>图表控制器]
        end
        
        subgraph Services["服务层 (Services)"]
            PM[ProjectManager<br/>项目管理器]
            CurveM[CurveManager<br/>曲线管理器]
            AS[AlgorithmService<br/>算法服务]
            HM[HistoryManager<br/>历史管理器]
        end
    end
    
    subgraph 领域层["🎯 领域层 (Domain Layer)"]
        direction TB
        
        subgraph DataModels["数据模型 (Data Models)"]
            TDP[ThermalDataPoint<br/>热分析数据点]
            TC[ThermalCurve<br/>热分析曲线<br/><i>rawData / processedData</i>]
            TProj[ThermalProject<br/>热分析项目]
        end
        
        subgraph AlgoInterfaces["算法接口 (Algorithm Interfaces)"]
            ITA[IThermalAlgorithm<br/>算法接口]
            ICmd[ICommand<br/>命令接口]
        end
        
        TC -->|包含多个| TDP
        TProj -->|管理多条| TC
    end
    
    subgraph 基础设施层["🔧 基础设施层 (Infrastructure Layer)"]
        direction TB
        
        subgraph FileIO["文件输入输出 (FileIO)"]
            Reader[Reader<br/>文件读取器<br/><i>多格式支持</i>]
            Writer[Writer<br/>文件写入器<br/><i>多格式导出</i>]
            Factory[FileReaderFactory<br/>文件工厂]
        end
        
        subgraph Algorithm["算法实现 (Algorithm)"]
            BC[BaselineCorrector<br/>基线校正]
            SA[SmoothingAlgorithm<br/>平滑算法]
            PD[PeakDetector<br/>峰值检测]
            Kinetics[KineticsAnalyzer<br/>动力学分析]
        end
        
        subgraph Utility["工具类 (Utility)"]
            DD[DataDecimator<br/>数据抽稀<br/><i>Douglas-Peucker/LTTB</i>]
            DI[DataInterpolator<br/>数据插值]
            SC[StatisticsCalculator<br/>统计计算]
        end
        
        Factory -->|创建| Reader
        Factory -->|创建| Writer
    end
    
    %% 层间依赖关系
    MW_Signal -->|信号槽连接| MC
    CV_Signal -->|信号槽连接| CC
    TP_Signal -->|信号槽连接| MC
    
    MC -->|协调调用| PM
    MC -->|协调调用| CurveM
    MC -->|协调调用| AS
    MC -->|协调调用| HM
    CC -->|协调调用| CurveM
    CC -->|协调调用| AS
    
    PM -->|管理| TProj
    CurveM -->|管理| TC
    AS -->|调度| ITA
    HM -->|执行| ICmd
    
    BC -.实现.-> ITA
    SA -.实现.-> ITA
    PD -.实现.-> ITA
    Kinetics -.实现.-> ITA
    
    Reader -->|解析生成| TC
    Writer -->|导出| TC
    
    AS -->|调用具体算法| BC
    AS -->|调用具体算法| SA
    AS -->|调用具体算法| PD
    AS -->|调用具体算法| Kinetics
    
    CV -->|使用工具| DD
    CV -->|使用工具| DI
    
    %% 样式定义
    classDef presentationStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#000
    classDef applicationStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#000
    classDef domainStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#000
    classDef infrastructureStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#000
    
    class MW,CV,TP,MW_Signal,CV_Signal,TP_Signal presentationStyle
    class MC,CC,PM,CurveM,AS,HM applicationStyle
    class TDP,TC,TProj,ITA,ICmd domainStyle
    class Reader,Writer,Factory,BC,SA,PD,Kinetics,DD,DI,SC infrastructureStyle
