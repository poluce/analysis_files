## 🏗️ DSC/TGA热分析软件 - 模块化架构设计

### 📋 一、系统概述

**系统名称**: ThermalAnalysis (热分析软件)
 **核心功能**: DSC/TGA数据采集、处理、分析、可视化
 **技术栈**: Qt 5.14.2 / Qt 6.8.2, C++17
 **架构模式**: 分层架构 + MVC + 插件化算法系统

------

## 🧩 二、模块划分(4层架构)

```
┌─────────────────────────────────────────────────────┐
│              表示层 (Presentation Layer)             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │MainWindow│  │ChartView │  │ToolPanel │          │
│  └──────────┘  └──────────┘  └──────────┘          │
└─────────────────────┬───────────────────────────────┘
                      │ Signals/Slots
┌─────────────────────┴───────────────────────────────┐
│              应用层 (Application Layer)              │
│  ┌──────────────┐  ┌───────────────┐               │
│  │ Controller   │  │ Service层      │               │
│  │ - MainCtrl   │  │ - ProjectMgr  │               │
│  │ - ChartCtrl  │  │ - CurveMgr    │               │
│  │              │  │ - AlgorithmSvc│               │
│  │              │  │ - HistoryMgr  │               │
│  └──────────────┘  └───────────────┘               │
└─────────────────────┬───────────────────────────────┘
                      │ 业务调用
┌─────────────────────┴───────────────────────────────┐
│              领域层 (Domain Layer)                   │
│  ┌──────────────┐  ┌───────────────┐               │
│  │ 数据模型     │  │ 算法接口      │               │
│  │ - DataPoint  │  │ - IAlgorithm  │               │
│  │ - Curve      │  │ - ICommand    │               │
│  │ - Project    │  │               │               │
│  └──────────────┘  └───────────────┘               │
└─────────────────────┬───────────────────────────────┘
                      │ 依赖
┌─────────────────────┴───────────────────────────────┐
│          基础设施层 (Infrastructure Layer)           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │FileIO    │  │Algorithm │  │Utility   │          │
│  │- Reader  │  │- 具体实现 │  │- 数据处理 │          │
│  │- Writer  │  │          │  │- 渲染优化 │          │
│  └──────────┘  └──────────┘  └──────────┘          │
└─────────────────────────────────────────────────────┘
```

------

## 📦 三、核心模块详细设计

### 🔷 3.1 领域层 (Domain Layer)

**职责**: 定义核心业务对象和规则,不依赖任何其他层

#### 模块1: 数据模型模块

```cpp
模块名: DataModel
位置: src/domain/model/

核心类:
┌─────────────────────────────────┐
│ ThermalDataPoint                │
├─────────────────────────────────┤
│ - double temperature            │ 温度值
│ - double value                  │ 热流/质量值
│ - double time                   │ 时间戳
│ - QVariantMap metadata          │ 扩展元数据
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ThermalCurve                    │
├─────────────────────────────────┤
│ - QString id                    │ 唯一标识
│ - QString name                  │ 曲线名称
│ - CurveType type                │ DSC/TGA/DTG
│ - QVector<DataPoint> rawData    │ 原始数据(只读)
│ - QVector<DataPoint> processed  │ 处理后数据
│ - CurveMetadata metadata        │ 实验参数
├─────────────────────────────────┤
│ + getRawData() const            │
│ + getProcessedData() const      │
│ + setProcessedData(...)         │
│ + resetToRaw()                  │ 恢复原始数据
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ThermalProject                  │
├─────────────────────────────────┤
│ - QString projectId             │
│ - QString projectName           │
│ - QList<ThermalCurve*> curves   │
│ - ProjectSettings settings      │
├─────────────────────────────────┤
│ + addCurve(...)                 │
│ + removeCurve(...)              │
│ + getCurve(id)                  │
│ + getAllCurves()                │
└─────────────────────────────────┘

设计要点:
1. ThermalCurve内部维护两份数据:
   - rawData: 加载后不可变,用于撤销恢复
   - processedData: 可修改,用于显示和计算
   
2. 数据不可变性保证:
   - getRawData()返回const引用
   - 没有setRawData()方法
   
3. 扩展性:
   - 用QVariantMap存储元数据,支持自定义字段
```

#### 模块2: 算法接口模块

```cpp
模块名: AlgorithmInterface
位置: src/domain/algorithm/

核心接口:
┌─────────────────────────────────┐
│ IThermalAlgorithm (接口)        │
├─────────────────────────────────┤
│ + process(input) = 0            │ 纯虚函数
│ + name() const = 0              │
│ + category() const = 0          │ 算法分类
│ + parameters() const            │ 返回参数定义
│ + setParameter(key, value)      │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ICommand (接口)                 │
├─────────────────────────────────┤
│ + execute() = 0                 │
│ + undo() = 0                    │
│ + redo()                        │ 默认调用execute
│ + description() const = 0       │
│ + canUndo() const               │
└─────────────────────────────────┘

设计要点:
1. 算法接口支持参数化:
   - parameters()返回算法需要的参数列表
   - 例如: 平滑算法需要"窗口大小"参数
   
2. 命令模式接口:
   - 所有修改数据的操作都封装为Command
   - 天然支持撤销/重做
```

------

### 🔷 3.2 基础设施层 (Infrastructure Layer)

**职责**: 提供技术支持,不包含业务逻辑

#### 模块3: 文件IO模块

```cpp
模块名: FileIO
位置: src/infrastructure/io/

核心类:
┌─────────────────────────────────┐
│ IFileReader (接口)              │
├─────────────────────────────────┤
│ + canRead(filePath) = 0         │ 判断是否支持
│ + read(filePath) = 0            │ 返回ThermalCurve
│ + supportedFormats() = 0        │ 返回支持的格式
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ DSCFileReader : IFileReader     │
├─────────────────────────────────┤
│ + canRead(...)                  │ 检查文件头
│ + read(...)                     │ 解析DSC格式
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ TGAFileReader : IFileReader     │
├─────────────────────────────────┤
│ + canRead(...)                  │
│ + read(...)                     │ 解析TGA格式
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ FileReaderFactory               │
├─────────────────────────────────┤
│ - QList<IFileReader*> readers   │
├─────────────────────────────────┤
│ + registerReader(...)           │ 注册读取器
│ + getReader(filePath)           │ 自动选择读取器
│ + supportedFormats()            │ 返回所有支持格式
└─────────────────────────────────┘

设计要点:
1. 策略模式: 每种文件格式一个Reader
2. 工厂模式: Factory自动选择合适的Reader
3. 可扩展: 新增格式只需实现IFileReader并注册
```

#### 模块4: 算法实现模块

```cpp
模块名: AlgorithmImpl
位置: src/infrastructure/algorithm/

具体算法类:
┌─────────────────────────────────┐
│ BaselineCorrector               │
│  : IThermalAlgorithm            │
├─────────────────────────────────┤
│ - BaselineType type             │ 线性/多项式/样条
│ - int polynomialOrder           │ 多项式阶数
├─────────────────────────────────┤
│ + process(input)                │
│ + name() = "BaselineCorrection" │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ SmoothingAlgorithm              │
│  : IThermalAlgorithm            │
├─────────────────────────────────┤
│ - int windowSize                │ 平滑窗口
│ - SmoothType type               │ 移动平均/SG滤波
├─────────────────────────────────┤
│ + process(input)                │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ PeakDetector                    │
│  : IThermalAlgorithm            │
├─────────────────────────────────┤
│ - double threshold              │ 峰值阈值
│ - int minPeakWidth              │ 最小峰宽
├─────────────────────────────────┤
│ + detectPeaks(input)            │ 返回峰列表
│ + calculatePeakArea(...)        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ KineticsCalculator              │
│  : IThermalAlgorithm            │
├─────────────────────────────────┤
│ + calculateActivationEnergy()   │ 活化能
│ + calculatePreExponential()     │ 指前因子
│ + isoConversionalMethod()       │ 等转化率法
└─────────────────────────────────┘

算法分类:
- 预处理类: Baseline, Smoothing, Normalization
- 分析类: PeakDetection, Integration, Differentiation
- 动力学类: Kinetics, ModelFitting
- 比较类: CurveSubtraction, Overlay
```

#### 模块5: 数据处理工具模块

```cpp
模块名: DataUtility
位置: src/infrastructure/utility/

核心类:
┌─────────────────────────────────┐
│ DataDecimator                   │ 数据抽稀
├─────────────────────────────────┤
│ + decimate(data, maxPoints)     │ 道格拉斯-普克算法
│ + decimateByZoom(data, range)   │ 根据可视范围
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ DataInterpolator                │ 数据插值
├─────────────────────────────────┤
│ + linearInterpolate(...)        │
│ + splineInterpolate(...)        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ StatisticsCalculator            │ 统计计算
├─────────────────────────────────┤
│ + mean(data)                    │
│ + stddev(data)                  │
│ + findExtrema(data)             │ 找极值点
└─────────────────────────────────┘
```

------

### 🔷 3.3 应用层 (Application Layer)

**职责**: 协调业务流程,连接UI和业务逻辑

#### 模块6: 项目管理模块

```cpp
模块名: ProjectManagement
位置: src/application/project/

核心类:
┌─────────────────────────────────┐
│ ProjectManager (单例)           │
├─────────────────────────────────┤
│ - ThermalProject* current       │ 当前项目
│ - QList<Project*> recentProjects│ 最近项目列表
├─────────────────────────────────┤
│ + createNewProject()            │
│ + openProject(path)             │
│ + saveProject()                 │
│ + saveProjectAs(path)           │
│ + closeProject()                │
│ + currentProject()              │
├─────────────────────────────────┤
│ signals:                        │
│ - projectOpened(project)        │
│ - projectClosed()               │
│ - projectModified()             │
│ - projectSaved()                │
└─────────────────────────────────┘

设计要点:
1. 单例模式: 全局唯一的项目管理器
2. 项目文件格式: JSON或XML,包含:
   - 项目元数据
   - 曲线列表(引用)
   - 处理历史
   - 分析结果
```

#### 模块7: 曲线管理模块

```cpp
模块名: CurveManagement
位置: src/application/curve/

核心类:
┌─────────────────────────────────┐
│ CurveManager (单例)             │
├─────────────────────────────────┤
│ - QString activeCurveId         │ 当前激活曲线
│ - QMap<QString, Curve*> curves  │ 所有曲线
├─────────────────────────────────┤
│ + loadCurveFromFile(path)       │ 异步加载
│ + createCurve(...)              │
│ + removeCurve(id)               │
│ + setActiveCurve(id)            │
│ + getActiveCurve()              │
│ + getCurve(id)                  │
│ + getAllCurves()                │
├─────────────────────────────────┤
│ signals:                        │
│ - curveLoaded(id)               │
│ - curveRemoved(id)              │
│ - activeCurveChanged(id)        │
│ - curveDataChanged(id)          │ 数据被修改
└─────────────────────────────────┘

设计要点:
1. 所有曲线数据的统一入口
2. 信号通知机制,数据变化自动通知UI
3. 异步加载大文件,避免阻塞
```

#### 模块8: 算法服务模块

```cpp
模块名: AlgorithmService
位置: src/application/algorithm/

核心类:
┌─────────────────────────────────┐
│ AlgorithmService (单例)         │
├─────────────────────────────────┤
│ - QMap<QString, IAlgorithm*>    │ 算法注册表
│ - QThreadPool* threadPool       │ 线程池
├─────────────────────────────────┤
│ + registerAlgorithm(name, algo) │
│ + getAlgorithm(name)            │
│ + getAllAlgorithms()            │
│ + executeAsync(name, curveId,   │ 异步执行
│                input, params)   │
├─────────────────────────────────┤
│ signals:                        │
│ - algorithmStarted(name)        │
│ - algorithmProgress(percent)    │
│ - algorithmFinished(curveId,    │
│                     result)     │
│ - algorithmFailed(error)        │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ AlgorithmTask : QRunnable       │ 异步任务
├─────────────────────────────────┤
│ - IAlgorithm* algorithm         │
│ - QVector<DataPoint> input      │
├─────────────────────────────────┤
│ + run()                         │ 线程池执行
└─────────────────────────────────┘

设计要点:
1. 异步执行,不阻塞UI线程
2. 进度反馈机制
3. 插件式算法注册,易于扩展
```

#### 模块9: 历史管理模块

```cpp
模块名: HistoryManagement
位置: src/application/history/

核心类:
┌─────────────────────────────────┐
│ HistoryManager (单例)           │
├─────────────────────────────────┤
│ - QStack<ICommand*> undoStack   │
│ - QStack<ICommand*> redoStack   │
│ - int maxHistorySize            │ 最大历史记录数
├─────────────────────────────────┤
│ + execute(command)              │ 执行并入栈
│ + undo()                        │
│ + redo()                        │
│ + canUndo() const               │
│ + canRedo() const               │
│ + clear()                       │
│ + getUndoList()                 │ 撤销列表
│ + getRedoList()                 │ 重做列表
├─────────────────────────────────┤
│ signals:                        │
│ - historyChanged()              │
│ - commandExecuted(desc)         │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ AlgorithmCommand : ICommand     │ 算法命令
├─────────────────────────────────┤
│ - ThermalCurve* curve           │
│ - QString algorithmName         │
│ - QVector<DataPoint> oldData    │ 保存旧数据
│ - QVector<DataPoint> newData    │ 保存新数据
├─────────────────────────────────┤
│ + execute()                     │ 执行算法
│ + undo()                        │ 恢复旧数据
└─────────────────────────────────┘

设计要点:
1. 命令模式实现撤销/重做
2. 限制历史记录数量,避免内存溢出
3. 所有修改操作都封装为Command
```

------

### 🔷 3.4 表示层 (Presentation Layer)

**职责**: 用户界面显示和交互,不包含业务逻辑

#### 模块10: 主界面模块

```cpp
模块名: MainUI
位置: src/ui/main/

核心类:
┌─────────────────────────────────┐
│ MainWindow : QMainWindow        │
├─────────────────────────────────┤
│ - ThermalChartView* chartView   │
│ - QDockWidget* curveListDock    │
│ - QDockWidget* propertyDock     │
│ - QToolBar* toolBar             │
├─────────────────────────────────┤
│ + setupUI()                     │
│ + updateCurveList()             │
│ + setStatusMessage(msg)         │
│ + showProgress(msg)             │
│ + hideProgress()                │
├─────────────────────────────────┤
│ signals:                        │
│ - openFileRequested()           │
│ - saveProjectRequested()        │
│ - algorithmRequested(name)      │
│ - undoRequested()               │
│ - redoRequested()               │
└─────────────────────────────────┘

设计要点:
1. MainWindow只负责UI布局和事件发射
2. 所有业务逻辑由Controller处理
3. 通过信号与Controller解耦
```

#### 模块11: 图表显示模块

```cpp
模块名: ChartVisualization
位置: src/ui/chart/

核心类:
┌─────────────────────────────────┐
│ ThermalChartView : QChartView   │
├─────────────────────────────────┤
│ - QChart* chart                 │
│ - QMap<QString, Series*> series │ 多曲线
│ - ChartDataAdapter* adapter     │ 数据适配
│ - SelectionRect* selection      │ 选择框
├─────────────────────────────────┤
│ + addCurve(id, data, color)     │
│ + updateCurve(id, data)         │
│ + removeCurve(id)               │
│ + enableSelection(bool)         │
│ + setVisibleRange(xMin, xMax)   │
│ + exportImage(path)             │
├─────────────────────────────────┤
│ signals:                        │
│ - regionSelected(id, start, end)│
│ - pointClicked(id, index)       │
│ - zoomChanged(xMin, xMax)       │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ChartDataAdapter                │ 数据适配器
├─────────────────────────────────┤
│ + getDisplayData(source, range, │ 根据缩放级别
│                  maxPoints)     │ 自动抽稀
└─────────────────────────────────┘

设计要点:
1. 数据适配器实现LOD(细节层次)
2. 大数据量时自动抽稀,保证流畅性
3. 支持多曲线叠加显示
4. 交互选择区域,发射信号给Controller
```

#### 模块12: 控制器模块

```cpp
模块名: Controller
位置: src/ui/controller/

核心类:
┌─────────────────────────────────┐
│ MainController : QObject        │
├─────────────────────────────────┤
│ - ProjectManager* projectMgr    │ (依赖注入)
│ - CurveManager* curveMgr        │ (依赖注入)
│ - AlgorithmService* algoSvc     │ (依赖注入)
│ - HistoryManager* history       │ (依赖注入)
├─────────────────────────────────┤
│ + MainController(services...)   │ 构造时注入服务
├─────────────────────────────────┤
│ private slots:                  │
│ - onOpenFile()                  │ 文件操作
│ - onSaveProject()               │
│ - onBaselineCorrection()        │ 算法操作
│ - onSmoothing()                 │
│ - onPeakDetection()             │
│ - onUndo()                      │ 历史操作
│ - onRedo()                      │
│ - onCurveDataChanged(id)        │ 数据变化
│ - onAlgorithmFinished(...)      │ 算法完成
└─────────────────────────────────┘

设计要点:
1. MVC模式的C (Controller)
2. 在应用启动时连接View的信号到槽函数
3. 协调各个Manager和Service
4. 不包含具体的算法实现,不直接持有View指针
```

------

## 📊 四、模块依赖关系

```
         [MainWindow] ──signals──> [MainController]
              │                          │
              │                          │ 调用
              ↓                          ↓
      [ThermalChartView]         ┌──────────────┐
                                 │  Managers    │
                                 │  - Project   │
                                 │  - Curve     │
                                 │  - Algorithm │
                                 │  - History   │
                                 └──────┬───────┘
                                        │ 操作
                                        ↓
                                 ┌──────────────┐
                                 │ Domain Model │
                                 │  - Curve     │
                                 │  - Project   │
                                 └──────┬───────┘
                                        │ 使用
                                        ↓
                                 ┌──────────────┐
                                 │Infrastructure│
                                 │  - FileIO    │
                                 │  - Algorithm │
                                 │  - Utility   │
                                 └──────────────┘

依赖规则:
✅ 上层可以依赖下层
❌ 下层不能依赖上层
✅ 同层之间通过接口依赖
```

------

## 🔌 五、模块间通信机制

### 5.1 信号槽机制 (Qt Signals/Slots)

```cpp
// UI → Controller: 用户操作
MainWindow::openFileRequested() 
    → MainController::onOpenFile()

// Manager → Controller: 状态变化
CurveManager::curveDataChanged(id) 
    → MainController::onCurveDataChanged(id)
    → MainWindow::updateChart()

// Service → Controller: 异步结果
AlgorithmService::algorithmFinished(id, result)
    → MainController::onAlgorithmFinished(...)
```

### 5.2 直接调用 (同步操作)

```cpp
// Controller 调用 Manager
auto curve = curveMgr->getActiveCurve();
projectMgr->saveProject();

// Manager 调用 Domain
curve->setProcessedData(newData);
```

### 5.3 事件驱动 (异步操作)

```cpp
// 算法服务使用线程池
algoService->executeAsync(algoName, curveId, data);
    → AlgorithmTask在工作线程执行
    → 完成后发射信号回主线程
```

------

## 📁 六、目录结构

```
ThermalAnalysis/
├── src/
│   ├── domain/                    # 领域层
│   │   ├── model/                 # 数据模型
│   │   │   ├── ThermalDataPoint.h/cpp
│   │   │   ├── ThermalCurve.h/cpp
│   │   │   └── ThermalProject.h/cpp
│   │   └── algorithm/             # 算法接口
│   │       ├── IThermalAlgorithm.h
│   │       └── ICommand.h
│   │
│   ├── infrastructure/            # 基础设施层
│   │   ├── io/                    # 文件IO
│   │   │   ├── IFileReader.h
│   │   │   ├── DSCFileReader.h/cpp
│   │   │   ├── TGAFileReader.h/cpp
│   │   │   └── FileReaderFactory.h/cpp
│   │   ├── algorithm/             # 算法实现
│   │   │   ├── BaselineCorrector.h/cpp
│   │   │   ├── SmoothingAlgorithm.h/cpp
│   │   │   ├── PeakDetector.h/cpp
│   │   │   └── KineticsCalculator.h/cpp
│   │   └── utility/               # 工具类
│   │       ├── DataDecimator.h/cpp
│   │       ├── DataInterpolator.h/cpp
│   │       └── StatisticsCalculator.h/cpp
│   │
│   ├── application/               # 应用层
│   │   ├── project/               # 项目管理
│   │   │   └── ProjectManager.h/cpp
│   │   ├── curve/                 # 曲线管理
│   │   │   └── CurveManager.h/cpp
│   │   ├── algorithm/             # 算法服务
│   │   │   ├── AlgorithmService.h/cpp
│   │   │   └── AlgorithmTask.h/cpp
│   │   └── history/               # 历史管理
│   │       ├── CommandHistory.h/cpp
│   │       └── AlgorithmCommand.h/cpp
│   │
│   ├── ui/                        # 表示层
│   │   ├── main/                  # 主界面
│   │   │   ├── MainWindow.h/cpp/ui
│   │   │   └── MainController.h/cpp
│   │   ├── chart/                 # 图表
│   │   │   ├── ThermalChartView.h/cpp
│   │   │   └── ChartDataAdapter.h/cpp
│   │   └── dialogs/               # 对话框
│   │       ├── AlgorithmDialog.h/cpp/ui
│   │       └── ProjectSettingsDialog.h/cpp/ui
│   │
│   └── main.cpp                   # 入口
│
├── tests/                         # 单元测试
│   ├── domain/
│   ├── infrastructure/
│   └── application/
│
├── docs/                          # 文档
│   ├── architecture.md            # 架构文档(本文档)
│   ├── api.md                     # API文档
│   └── user_manual.md             # 用户手册
│
├── resources/                     # 资源文件
│   ├── icons/
│   └── qss/                       # 样式表
│
├── CMakeLists.txt                 # 构建配置
└── README.md
```

------

## 🎯 七、扩展性设计

### 7.1 新增文件格式

```cpp
// 步骤1: 实现IFileReader接口
class NewFormatReader : public IFileReader {
    bool canRead(const QString& path) override;
    ThermalCurve read(const QString& path) override;
};

// 步骤2: 注册到Factory
FileReaderFactory::instance()->registerReader(
    new NewFormatReader()
);

// 无需修改任何现有代码!
```

### 7.2 新增算法

```cpp
// 步骤1: 实现IThermalAlgorithm接口
class NewAlgorithm : public IThermalAlgorithm {
    QVector<ThermalDataPoint> process(...) override;
    QString name() const override { return "NewAlgo"; }
};

// 步骤2: 注册到Service
AlgorithmService::instance()->registerAlgorithm(
    "NewAlgo",
    new NewAlgorithm()
);

// 步骤3: (可选)在UI添加菜单项
// 连接到 MainController::onAlgorithmRequested("NewAlgo")

// 撤销功能自动支持!
```

### 7.3 新增显示方式

```cpp
// 例如: 新增3D热图显示
class ThermalHeatmapView : public QWidget {
    void setData(const ThermalCurve* curve);
    // ... 实现
};

// 在MainWindow中添加
// Controller逻辑无需改变
```

------

## ⚙️ 八、性能优化策略

### 8.1 大数据处理

```
问题: 30万数据点加载和显示
解决方案:
1. 异步加载 - 工作线程读取文件
2. 数据抽稀 - ChartDataAdapter根据缩放动态抽稀
3. LOD策略 - 远看用1000点,近看用完整数据
4. 视口裁剪 - 只渲染可见范围
```

### 8.2 算法性能

```
问题: 复杂算法耗时长
解决方案:
1. 异步执行 - AlgorithmTask在线程池运行
2. 进度反馈 - 算法内部发射进度信号
3. 可中断 - 算法检查中断标志
4. 缓存结果 - 相同参数不重复计算
```

### 8.3 内存管理

```
问题: 多条曲线占用内存大
解决方案:
1. 隐式共享 - 使用QVector(自动写时复制)
2. 智能指针 - 自动管理ThermalCurve生命周期
3. 懒加载 - 曲线数据按需加载
4. 历史限制 - CommandHistory限制栈深度
```

------

## ✅ 九、设计原则总结

这个架构遵循了以下设计原则:

1. **单一职责原则 (SRP)**
   - 每个类只负责一件事
   - ThermalCurve只管数据,不管显示
   - ThermalChartView只管显示,不管计算
2. **开闭原则 (OCP)**
   - 对扩展开放:新增算法/格式无需改代码
   - 对修改关闭:核心接口稳定
3. **依赖倒置原则 (DIP)**
   - 依赖抽象(IThermalAlgorithm),不依赖具体
   - Controller依赖IManager接口,不依赖具体实现
4. **接口隔离原则 (ISP)**
   - 接口小而专:IFileReader, IThermalAlgorithm
   - 客户端不依赖不需要的接口
5. **迪米特法则 (LoD)**
   - MainWindow不直接访问ThermalCurve
   - 通过Controller和Manager间接访问

------

## 🎓 十、总结

这个架构设计具有以下特点:

✅ **模块化清晰** - 4层架构,职责明确
 ✅ **高内聚低耦合** - 模块独立,接口简洁
 ✅ **易于扩展** - 插件式算法,新增功能不改旧代码
 ✅ **易于测试** - 每个模块可独立测试
 ✅ **支持大数据** - 异步处理+数据抽稀
 ✅ **用户体验好** - 撤销/重做,进度反馈

------

这份设计文档是否符合你的需求?有什么地方需要调整或细化的吗? 😊