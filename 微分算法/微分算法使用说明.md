# å¾®åˆ†ç®—æ³•å‡½æ•°åº“ - ä½¿ç”¨è¯´æ˜

## ğŸ“š æ–‡ä»¶æ¸…å•

- **å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….h** - å¤´æ–‡ä»¶ï¼ˆå‡½æ•°å£°æ˜ï¼‰
- **å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….cpp** - å®ç°æ–‡ä»¶ï¼ˆå‡½æ•°å®šä¹‰ï¼‰
- **å¾®åˆ†ç®—æ³•ä½¿ç”¨è¯´æ˜.md** - æœ¬æ–‡æ¡£
- **å¾®åˆ†ç®—æ³•åˆ†ææŠ¥å‘Š.md** - ç®—æ³•åŸç†åˆ†æ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é›†æˆåˆ°é¡¹ç›®

å°†ä»¥ä¸‹æ–‡ä»¶æ·»åŠ åˆ°ä½ çš„Qté¡¹ç›®ä¸­ï¼š

```cpp
// åœ¨ä½ çš„.proæ–‡ä»¶ä¸­æ·»åŠ 
HEADERS += å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….h
SOURCES += å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….cpp

// åœ¨éœ€è¦ä½¿ç”¨çš„æºæ–‡ä»¶ä¸­å¼•å…¥
#include "å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….h"
```

### 2. åŸºç¡€ç¤ºä¾‹

```cpp
#include "å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….h"

// å‡†å¤‡æ•°æ®
QList<double> temperature = {20, 25, 30, 35, ...};  // æ¸©åº¦æ•°æ®
QList<double> mass = {100, 99.5, 98.8, 98.0, ...};  // è´¨é‡æ•°æ®

// è®¡ç®—DTGå¾®åˆ†
QList<double> dtgX, dtgY;
if (calculateDTGDerivative(temperature, mass, 50, 0.1, dtgX, dtgY)) {
    qDebug() << "å¾®åˆ†è®¡ç®—æˆåŠŸï¼";
    // dtgXå’ŒdtgYç°åœ¨åŒ…å«å¾®åˆ†æ›²çº¿æ•°æ®
}
```

---

## ğŸ“– å‡½æ•°è¯¦è§£

### å‡½æ•°1: DTGå¾®åˆ†ç®—æ³• â­â­â­â­â­

**æœ€å¸¸ç”¨çš„å‡½æ•°ï¼Œé€‚åˆå¤§å¤šæ•°TG/DSCæ•°æ®åˆ†æ**

#### å‡½æ•°ç­¾å

```cpp
bool calculateDTGDerivative(
    const QList<double>& xData,      // è¾“å…¥: Xè½´æ•°æ®ï¼ˆæ¸©åº¦/æ—¶é—´ï¼‰
    const QList<double>& yData,      // è¾“å…¥: Yè½´æ•°æ®ï¼ˆè´¨é‡/çƒ­æµï¼‰
    int halfWin,                      // è¾“å…¥: åŠçª—å£å¤§å°
    double dt,                        // è¾“å…¥: æ—¶é—´æ­¥é•¿
    QList<double>& outX,             // è¾“å‡º: å¾®åˆ†æ›²çº¿Xåæ ‡
    QList<double>& outY              // è¾“å‡º: å¾®åˆ†æ›²çº¿Yåæ ‡ï¼ˆå¯¼æ•°ï¼‰
);
```

#### å‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | è¯´æ˜ | æ¨èå€¼ |
|------|------|------|--------|
| `xData` | const QList<double>& | æ¨ªåæ ‡æ•°æ®ï¼ˆæ¸©åº¦/æ—¶é—´ï¼‰ | - |
| `yData` | const QList<double>& | çºµåæ ‡æ•°æ®ï¼ˆè´¨é‡/çƒ­æµï¼‰ | - |
| `halfWin` | int | åŠçª—å£å¤§å°ï¼ˆå•ä¾§ç‚¹æ•°ï¼‰ | 25-50 |
| `dt` | double | è™šæ‹Ÿæ—¶é—´æ­¥é•¿ | 0.1 |
| `outX` | QList<double>& | è¾“å‡ºå¾®åˆ†æ›²çº¿Xåæ ‡ | - |
| `outY` | QList<double>& | è¾“å‡ºå¾®åˆ†æ›²çº¿Yåæ ‡ | - |

#### è¿”å›å€¼

- `true`: è®¡ç®—æˆåŠŸ
- `false`: è®¡ç®—å¤±è´¥ï¼ˆæ•°æ®ç‚¹ä¸è¶³æˆ–å‚æ•°é”™è¯¯ï¼‰

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// ç¤ºä¾‹1: æ ‡å‡†TGåˆ†æ
QList<double> temp, mass, dtgX, dtgY;

// å‡è®¾å·²åŠ è½½æ•°æ®...
// temp << 25.0 << 26.0 << 27.0 << ...;
// mass << 100.0 << 99.8 << 99.6 << ...;

// ä½¿ç”¨50ç‚¹çª—å£è®¡ç®—å¾®åˆ†
if (calculateDTGDerivative(temp, mass, 50, 0.1, dtgX, dtgY)) {
    qDebug() << "DTGè®¡ç®—æˆåŠŸï¼Œå…±" << dtgY.size() << "ä¸ªç‚¹";

    // ç»˜åˆ¶å¾®åˆ†æ›²çº¿
    QLineSeries* dtgSeries = new QLineSeries();
    for (int i = 0; i < dtgX.size(); ++i) {
        dtgSeries->append(dtgX[i], dtgY[i]);
    }
    dtgSeries->setName("DTGå¾®åˆ†æ›²çº¿");
}
```

#### çª—å£å¤§å°é€‰æ‹©æŒ‡å—

```cpp
// ä½å™ªå£°æ•°æ®ï¼ˆé«˜è´¨é‡ä»ªå™¨ï¼‰
calculateDTGDerivative(x, y, 10, 0.1, outX, outY);  // ä¿ç•™æ›´å¤šç»†èŠ‚

// ä¸­å™ªå£°æ•°æ®ï¼ˆå¸¸è§„å®éªŒï¼‰
calculateDTGDerivative(x, y, 25, 0.1, outX, outY);  // å¹³è¡¡æ¨¡å¼

// é«˜å™ªå£°æ•°æ®ï¼ˆè€æ—§ä»ªå™¨/ä¸ç¨³å®šæ¡ä»¶ï¼‰
calculateDTGDerivative(x, y, 50, 0.1, outX, outY);  // å¼ºå¹³æ»‘
```

---

### å‡½æ•°2: ç”µåŒ–å­¦å¾®åˆ†ç®—æ³• â­â­â­

**é€‚åˆç”µåŒ–å­¦æ•°æ®åˆ†æ**

#### å‡½æ•°ç­¾å

```cpp
bool calculateElectrochemicalDerivative(
    const QList<double>& xData,
    const QList<double>& yData,
    int windowSize,                   // çª—å£å¤§å°ï¼ˆé»˜è®¤25ï¼‰
    double normFactor,                // å½’ä¸€åŒ–ç³»æ•°ï¼ˆé»˜è®¤0.96ï¼‰
    QList<double>& outX,
    QList<double>& outY
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// è®¡ç®—ç”µå‹å¯¹æ—¶é—´çš„å¯¼æ•°
QList<double> time, voltage, dvX, dvY;

calculateElectrochemicalDerivative(time, voltage, 25, 0.96, dvX, dvY);
```

---

### å‡½æ•°3: ç§»åŠ¨å¹³å‡å¹³æ»‘ â­â­â­â­

**é¢„å¤„ç†å™ªå£°æ•°æ®**

#### å‡½æ•°ç­¾å

```cpp
QList<double> smoothWithMovingAverage(
    const QList<double>& data,        // è¾“å…¥æ•°æ®
    int windowSize                    // çª—å£å¤§å°
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// å¯¹åŸå§‹æ•°æ®è¿›è¡Œå¹³æ»‘
QList<double> rawData = {1.2, 1.5, 1.3, 1.6, 1.4, ...};
QList<double> smoothedData = smoothWithMovingAverage(rawData, 10);

// å¹³æ»‘åçš„æ•°æ®æ›´é€‚åˆåç»­åˆ†æ
```

---

### å‡½æ•°4: æ ‡å‡†ä¸­å¿ƒå·®åˆ† â­â­â­

**é€‚åˆä½å™ªå£°ã€é«˜ç²¾åº¦æ•°æ®**

#### å‡½æ•°ç­¾å

```cpp
bool calculateCentralDifference(
    const QList<double>& xData,
    const QList<double>& yData,
    QList<double>& outX,
    QList<double>& outY
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// é«˜è´¨é‡æ•°æ®çš„å¿«é€Ÿå¾®åˆ†
QList<double> x, y, derivX, derivY;

if (calculateCentralDifference(x, y, derivX, derivY)) {
    // è®¡ç®—é€Ÿåº¦å¿«ï¼Œç²¾åº¦é«˜
}
```

---

### å‡½æ•°5: äº”ç‚¹æ¨¡æ¿å·®åˆ† â­â­â­â­

**å››é˜¶ç²¾åº¦ç®—æ³•**

#### å‡½æ•°ç­¾å

```cpp
bool calculateFivePointDifference(
    const QList<double>& xData,
    const QList<double>& yData,
    QList<double>& outX,
    QList<double>& outY
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// æ¯”ä¸­å¿ƒå·®åˆ†æ›´ç²¾ç¡®
calculateFivePointDifference(xData, yData, outX, outY);
```

---

### å‡½æ•°6: è‡ªé€‚åº”çª—å£å¾®åˆ† â­â­â­â­â­

**æ™ºèƒ½é€‰æ‹©çª—å£å¤§å°ï¼Œæ¨èæ–°æ‰‹ä½¿ç”¨**

#### å‡½æ•°ç­¾å

```cpp
bool calculateAdaptiveDerivative(
    const QList<double>& xData,
    const QList<double>& yData,
    QList<double>& outX,
    QList<double>& outY,
    int* outWindowSize = nullptr      // å¯é€‰ï¼šè¿”å›ä½¿ç”¨çš„çª—å£å¤§å°
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
QList<double> x, y, derivX, derivY;
int usedWindow;

// è‡ªåŠ¨åˆ†ææ•°æ®å™ªå£°æ°´å¹³ï¼Œé€‰æ‹©æœ€ä½³çª—å£
if (calculateAdaptiveDerivative(x, y, derivX, derivY, &usedWindow)) {
    qDebug() << "è‡ªåŠ¨é€‰æ‹©çš„çª—å£å¤§å°:" << usedWindow;
}
```

#### è‡ªåŠ¨é€‰æ‹©é€»è¾‘

```
å™ªå£°æ°´å¹³ < 0.01  â†’ çª—å£ = 5   (ä½å™ªå£°)
å™ªå£°æ°´å¹³ < 0.1   â†’ çª—å£ = 25  (ä¸­å™ªå£°)
å™ªå£°æ°´å¹³ â‰¥ 0.1   â†’ çª—å£ = 50  (é«˜å™ªå£°)
```

---

### å‡½æ•°7: å…ˆå¹³æ»‘å†å¾®åˆ† â­â­â­â­

**ä¸¤æ­¥æ³•å¤„ç†æé«˜å™ªå£°æ•°æ®**

#### å‡½æ•°ç­¾å

```cpp
bool calculateSmoothThenDifferentiate(
    const QList<double>& xData,
    const QList<double>& yData,
    int smoothWindow,                 // å¹³æ»‘çª—å£å¤§å°
    QList<double>& outX,
    QList<double>& outY
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// å…ˆç”¨15ç‚¹çª—å£å¹³æ»‘ï¼Œå†è®¡ç®—å¾®åˆ†
calculateSmoothThenDifferentiate(xData, yData, 15, outX, outY);
```

---

### å‡½æ•°8: Qtå›¾è¡¨ä¸“ç”¨ç‰ˆæœ¬ â­â­â­â­â­

**ç›´æ¥å¤„ç†QVector<QPointF>æ ¼å¼**

#### å‡½æ•°ç­¾å

```cpp
QVector<QPointF> calculateDTGDerivativeFromPoints(
    const QVector<QPointF>& points,   // è¾“å…¥ç‚¹é›†
    int halfWin = 50,                 // åŠçª—å£å¤§å°
    double dt = 0.1                   // æ—¶é—´æ­¥é•¿
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
// ä»Qtå›¾è¡¨æ›²çº¿ç›´æ¥è®¡ç®—å¾®åˆ†
QLineSeries* originalSeries = ...; // åŸå§‹æ›²çº¿

// è·å–åŸå§‹æ•°æ®ç‚¹
const QVector<QPointF>& points = originalSeries->pointsVector();

// è®¡ç®—å¾®åˆ†ï¼ˆä¸€è¡Œä»£ç æå®šï¼ï¼‰
QVector<QPointF> dtgPoints = calculateDTGDerivativeFromPoints(points);

// åˆ›å»ºå¾®åˆ†æ›²çº¿
QLineSeries* dtgSeries = new QLineSeries();
dtgSeries->replace(dtgPoints);
dtgSeries->setName("DTG");
chart->addSeries(dtgSeries);
```

---

### å‡½æ•°9: æŸ¥æ‰¾æœ€å¤§å¯¼æ•°ç‚¹ â­â­â­â­â­

**æ‰¾å‡ºåˆ†è§£é€Ÿç‡æœ€å¿«çš„æ¸©åº¦ç‚¹**

#### å‡½æ•°ç­¾å

```cpp
bool findMaxDerivativePoint(
    const QList<double>& derivativeX,  // å¾®åˆ†æ›²çº¿Xåæ ‡
    const QList<double>& derivativeY,  // å¾®åˆ†æ›²çº¿Yåæ ‡
    double& maxX,                      // è¾“å‡ºï¼šæœ€å¤§å¯¼æ•°ç‚¹çš„Xåæ ‡
    double& maxY                       // è¾“å‡ºï¼šæœ€å¤§å¯¼æ•°å€¼
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
QList<double> dtgX, dtgY;
calculateDTGDerivative(temp, mass, 50, 0.1, dtgX, dtgY);

// æŸ¥æ‰¾æœ€å¤§åˆ†è§£é€Ÿç‡ç‚¹
double maxTempAtMaxRate, maxRate;
if (findMaxDerivativePoint(dtgX, dtgY, maxTempAtMaxRate, maxRate)) {
    qDebug() << "æœ€å¤§åˆ†è§£é€Ÿç‡æ¸©åº¦:" << maxTempAtMaxRate << "Â°C";
    qDebug() << "æœ€å¤§åˆ†è§£é€Ÿç‡:" << maxRate << "%/min";

    // åœ¨å›¾ä¸Šæ ‡è®°è¿™ä¸ªç‚¹
    QScatterSeries* marker = new QScatterSeries();
    marker->append(maxTempAtMaxRate, maxRate);
    marker->setMarkerSize(15);
    marker->setColor(Qt::red);
}
```

---

### å‡½æ•°10: æŸ¥æ‰¾æå€¼ç‚¹ï¼ˆå³°å’Œè°·ï¼‰ â­â­â­â­

**åˆ†æå¤šä¸ªåˆ†è§£é˜¶æ®µ**

#### å‡½æ•°ç­¾å

```cpp
void findDerivativeExtrema(
    const QList<double>& derivativeX,
    const QList<double>& derivativeY,
    double threshold,                  // é˜ˆå€¼ï¼ˆ0.0-1.0ï¼‰
    QList<double>& peakX,             // è¾“å‡ºï¼šæ‰€æœ‰å³°çš„Xåæ ‡
    QList<double>& peakY,             // è¾“å‡ºï¼šæ‰€æœ‰å³°çš„Yå€¼
    QList<double>& valleyX,           // è¾“å‡ºï¼šæ‰€æœ‰è°·çš„Xåæ ‡
    QList<double>& valleyY            // è¾“å‡ºï¼šæ‰€æœ‰è°·çš„Yå€¼
);
```

#### ä½¿ç”¨ç¤ºä¾‹

```cpp
QList<double> dtgX, dtgY;
calculateDTGDerivative(temp, mass, 50, 0.1, dtgX, dtgY);

// æŸ¥æ‰¾æ‰€æœ‰æ˜¾è‘—çš„å³°å’Œè°·
QList<double> peakX, peakY, valleyX, valleyY;
findDerivativeExtrema(dtgX, dtgY, 0.1, peakX, peakY, valleyX, valleyY);

qDebug() << "æ‰¾åˆ°" << peakX.size() << "ä¸ªåˆ†è§£é˜¶æ®µ";

// åœ¨å›¾ä¸Šæ ‡è®°æ‰€æœ‰å³°
for (int i = 0; i < peakX.size(); ++i) {
    qDebug() << "ç¬¬" << (i+1) << "é˜¶æ®µï¼Œæ¸©åº¦:" << peakX[i]
             << "Â°Cï¼Œé€Ÿç‡:" << peakY[i] << "%/min";
}
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯ä¸æ¨è

### åœºæ™¯1: æ ‡å‡†TGåˆ†æ

```cpp
// è¯»å–TGæ•°æ®
QList<double> temp, mass;
// ... ä»æ–‡ä»¶åŠ è½½æ•°æ® ...

// è®¡ç®—DTGå¾®åˆ†
QList<double> dtgX, dtgY;
calculateDTGDerivative(temp, mass, 50, 0.1, dtgX, dtgY);

// æŸ¥æ‰¾æœ€å¤§åˆ†è§£é€Ÿç‡
double tMax, rateMax;
findMaxDerivativePoint(dtgX, dtgY, tMax, rateMax);

qDebug() << "ä¸»è¦åˆ†è§£æ¸©åº¦:" << tMax << "Â°C";
```

### åœºæ™¯2: å¤šæ­¥åˆ†è§£åˆ†æ

```cpp
// è®¡ç®—å¾®åˆ†
QList<double> dtgX, dtgY;
calculateDTGDerivative(temp, mass, 50, 0.1, dtgX, dtgY);

// æŸ¥æ‰¾æ‰€æœ‰åˆ†è§£é˜¶æ®µ
QList<double> peakX, peakY, valleyX, valleyY;
findDerivativeExtrema(dtgX, dtgY, 0.15, peakX, peakY, valleyX, valleyY);

// åˆ†ææ¯ä¸ªé˜¶æ®µ
for (int i = 0; i < peakX.size(); ++i) {
    qDebug() << "åˆ†è§£é˜¶æ®µ" << (i+1);
    qDebug() << "  æ¸©åº¦:" << peakX[i] << "Â°C";
    qDebug() << "  é€Ÿç‡:" << peakY[i] << "%/min";
}
```

### åœºæ™¯3: DSCçƒ­æµåˆ†æ

```cpp
// DSCæ•°æ®é€šå¸¸å™ªå£°è¾ƒå¤§
QList<double> temp, heatFlow;
// ... åŠ è½½æ•°æ® ...

// å…ˆå¹³æ»‘å†å¾®åˆ†
QList<double> derivX, derivY;
calculateSmoothThenDifferentiate(temp, heatFlow, 20, derivX, derivY);

// æˆ–è€…ä½¿ç”¨è‡ªé€‚åº”ç®—æ³•
int window;
calculateAdaptiveDerivative(temp, heatFlow, derivX, derivY, &window);
qDebug() << "è‡ªåŠ¨é€‰æ‹©çª—å£:" << window;
```

### åœºæ™¯4: ç”µåŒ–å­¦å¾ªç¯ä¼å®‰

```cpp
QList<double> voltage, current;
// ... åŠ è½½CVæ•°æ® ...

// è®¡ç®—ç”µæµå¯¹ç”µå‹çš„å¯¼æ•°
QList<double> dvX, dvY;
calculateElectrochemicalDerivative(voltage, current, 25, 0.96, dvX, dvY);
```

### åœºæ™¯5: Qtå›¾è¡¨é›†æˆ

```cpp
void MainWindow::onCalculateDerivativeClicked()
{
    // è·å–å½“å‰é€‰ä¸­çš„æ›²çº¿
    QXYSeries* activeSeries = getSelectedSeries();
    if (!activeSeries) return;

    // ç›´æ¥ä»å›¾è¡¨æ•°æ®è®¡ç®—å¾®åˆ†
    QVector<QPointF> dtgPoints = calculateDTGDerivativeFromPoints(
        activeSeries->pointsVector(), 50, 0.1);

    // åˆ›å»ºå¾®åˆ†æ›²çº¿
    QLineSeries* dtgSeries = new QLineSeries();
    dtgSeries->replace(dtgPoints);
    dtgSeries->setName("DTG");
    dtgSeries->setPen(QPen(Qt::blue, 2));

    // æ·»åŠ åˆ°å›¾è¡¨
    chart->addSeries(dtgSeries);
    dtgSeries->attachAxis(chart->axisX());

    // åˆ›å»ºæ–°çš„Yè½´ç”¨äºå¾®åˆ†æ›²çº¿
    QValueAxis* dtgAxis = new QValueAxis();
    dtgAxis->setTitleText("DTG (mg/min)");
    chart->addAxis(dtgAxis, Qt::AlignLeft);
    dtgSeries->attachAxis(dtgAxis);
}
```

---

## âš™ï¸ å‚æ•°è°ƒä¼˜æŒ‡å—

### halfWin (åŠçª—å£å¤§å°)

**ä½œç”¨**: æ§åˆ¶å¹³æ»‘ç¨‹åº¦å’Œæ—¶é—´åˆ†è¾¨ç‡

| å€¼ | å¹³æ»‘åº¦ | åˆ†è¾¨ç‡ | é€‚ç”¨åœºæ™¯ |
|----|--------|--------|----------|
| 5-10 | ä½ | é«˜ | ä½å™ªå£°æ•°æ®ï¼Œéœ€è¦ä¿ç•™å¿«é€Ÿå˜åŒ– |
| 20-30 | ä¸­ | ä¸­ | å¹³è¡¡æ¨¡å¼ï¼Œå¤§å¤šæ•°æƒ…å†µé€‚ç”¨ |
| 40-60 | é«˜ | ä½ | é«˜å™ªå£°æ•°æ®ï¼Œéœ€è¦å¹³æ»‘æ›²çº¿ |
| 80-100 | å¾ˆé«˜ | å¾ˆä½ | æé«˜å™ªå£°ï¼Œåªå…³æ³¨ä¸»è¦è¶‹åŠ¿ |

**é€‰æ‹©å»ºè®®**:
```cpp
// ä¿¡å™ªæ¯”ä¼°ç®—
double signalRange = maxY - minY;
double noiseLevel = estimateNoise(yData);
double SNR = signalRange / noiseLevel;

if (SNR > 100) {
    halfWin = 10;  // é«˜ä¿¡å™ªæ¯”
} else if (SNR > 20) {
    halfWin = 25;  // ä¸­ä¿¡å™ªæ¯”
} else {
    halfWin = 50;  // ä½ä¿¡å™ªæ¯”
}
```

### dt (æ—¶é—´æ­¥é•¿)

**ä½œç”¨**: å½±å“å¾®åˆ†å€¼çš„å•ä½å’Œæ•°å€¼å¤§å°

**å¸¸ç”¨è®¾ç½®**:
- `dt = 0.1`: é»˜è®¤å€¼ï¼Œé€‚åˆå¤§å¤šæ•°æƒ…å†µ
- `dt = 1.0`: å¦‚æœå¸Œæœ›å¾®åˆ†å€¼æ›´å¤§
- `dt = é‡‡æ ·é—´éš”`: åŒ¹é…å®é™…æ—¶é—´å•ä½

### smoothWindow (å¹³æ»‘çª—å£)

**ä½œç”¨**: é¢„å¤„ç†å¹³æ»‘çš„å¼ºåº¦

**é€‰æ‹©è§„åˆ™**:
```
é‡‡æ ·é¢‘ç‡ 10 Hz  â†’ smoothWindow = 20-50
é‡‡æ ·é¢‘ç‡ 1 Hz   â†’ smoothWindow = 5-15
é‡‡æ ·é¢‘ç‡ 0.1 Hz â†’ smoothWindow = 3-8
```

### threshold (æå€¼æ£€æµ‹é˜ˆå€¼)

**ä½œç”¨**: æ§åˆ¶å³°è°·æ£€æµ‹çš„çµæ•åº¦

| å€¼ | çµæ•åº¦ | é€‚ç”¨åœºæ™¯ |
|----|--------|----------|
| 0.05-0.1 | é«˜ | æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„å³° |
| 0.1-0.3 | ä¸­ | æ ‡å‡†æ£€æµ‹ï¼ˆæ¨èï¼‰ |
| 0.3-0.5 | ä½ | åªæ‰¾ä¸»è¦çš„å³° |

```cpp
// å®½æ¾æ£€æµ‹ï¼šæ‰¾å‡ºæ‰€æœ‰å°å³°
findDerivativeExtrema(dtgX, dtgY, 0.05, peakX, peakY, valleyX, valleyY);

// ä¸¥æ ¼æ£€æµ‹ï¼šåªæ‰¾ä¸»è¦å³°
findDerivativeExtrema(dtgX, dtgY, 0.3, peakX, peakY, valleyX, valleyY);
```

---

## ğŸ› å¸¸è§é—®é¢˜ä¸è§£å†³

### é—®é¢˜1: è¿”å›falseï¼Œè®¡ç®—å¤±è´¥

**åŸå› **: æ•°æ®ç‚¹ä¸è¶³

```cpp
// æ£€æŸ¥æ•°æ®é‡
int minPoints = 2 * halfWin + 1;
if (yData.size() < minPoints) {
    qDebug() << "æ•°æ®ç‚¹ä¸è¶³ï¼éœ€è¦è‡³å°‘" << minPoints << "ä¸ªç‚¹";
    qDebug() << "å®é™…åªæœ‰" << yData.size() << "ä¸ªç‚¹";

    // è§£å†³æ–¹æ¡ˆ1ï¼šå‡å°çª—å£
    halfWin = yData.size() / 3;

    // è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨è‡ªé€‚åº”ç®—æ³•
    calculateAdaptiveDerivative(x, y, outX, outY);
}
```

### é—®é¢˜2: å¾®åˆ†æ›²çº¿å¤ª"æ¯›åˆº"

**åŸå› **: çª—å£å¤ªå°æˆ–å™ªå£°å¤ªå¤§

```cpp
// è§£å†³æ–¹æ¡ˆ1ï¼šå¢å¤§çª—å£
calculateDTGDerivative(x, y, 80, 0.1, outX, outY);  // ä»50å¢åˆ°80

// è§£å†³æ–¹æ¡ˆ2ï¼šå…ˆå¹³æ»‘å†å¾®åˆ†
calculateSmoothThenDifferentiate(x, y, 20, outX, outY);

// è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨è‡ªé€‚åº”ç®—æ³•
calculateAdaptiveDerivative(x, y, outX, outY);
```

### é—®é¢˜3: å¾®åˆ†æ›²çº¿å¤ªå¹³æ»‘ï¼Œç»†èŠ‚ä¸¢å¤±

**åŸå› **: çª—å£å¤ªå¤§

```cpp
// å‡å°çª—å£
calculateDTGDerivative(x, y, 15, 0.1, outX, outY);  // ä»50å‡åˆ°15

// æˆ–ä½¿ç”¨äº”ç‚¹æ¨¡æ¿
calculateFivePointDifference(x, y, outX, outY);
```

### é—®é¢˜4: å³°ä½ç½®ä¸å‡†ç¡®

**åŸå› **: å¤§çª—å£å¯¼è‡´å»¶è¿Ÿ

```cpp
// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¾ƒå°çª—å£
calculateDTGDerivative(x, y, 20, 0.1, outX, outY);

// æˆ–ä½¿ç”¨ä¸­å¿ƒå·®åˆ†ï¼ˆæ— å»¶è¿Ÿï¼‰
calculateCentralDifference(x, y, outX, outY);
```

### é—®é¢˜5: æ‰¾ä¸åˆ°å³°

**åŸå› **: é˜ˆå€¼è®¾ç½®å¤ªé«˜

```cpp
// é™ä½é˜ˆå€¼
findDerivativeExtrema(dtgX, dtgY, 0.05, peakX, peakY, valleyX, valleyY);

// æ£€æŸ¥å¾®åˆ†æ›²çº¿èŒƒå›´
double minDeriv = *std::min_element(dtgY.begin(), dtgY.end());
double maxDeriv = *std::max_element(dtgY.begin(), dtgY.end());
qDebug() << "å¾®åˆ†å€¼èŒƒå›´:" << minDeriv << "åˆ°" << maxDeriv;
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®é‡å¤§æ—¶çš„ä¼˜åŒ–

```cpp
// å¯¹äºè¶…å¤§æ•°æ®é›†ï¼ˆ>100,000ç‚¹ï¼‰ï¼Œè€ƒè™‘é™é‡‡æ ·
QList<double> downsampledX, downsampledY;
int step = yData.size() / 10000;  // é™é‡‡æ ·åˆ°çº¦10000ç‚¹

for (int i = 0; i < yData.size(); i += step) {
    downsampledX.append(xData[i]);
    downsampledY.append(yData[i]);
}

// åœ¨é™é‡‡æ ·æ•°æ®ä¸Šè®¡ç®—å¾®åˆ†
calculateDTGDerivative(downsampledX, downsampledY, 50, 0.1, outX, outY);
```

### 2. å®æ—¶è®¡ç®—ä¼˜åŒ–

```cpp
// ä½¿ç”¨è¾ƒå°çª—å£åŠ å¿«è®¡ç®—
calculateDTGDerivative(x, y, 25, 0.1, outX, outY);  // çª—å£25æ¯”50å¿«ä¸€å€

// æˆ–ä½¿ç”¨å¿«é€Ÿä¸­å¿ƒå·®åˆ†
calculateCentralDifference(x, y, outX, outY);  // æœ€å¿«
```

### 3. å†…å­˜ä¼˜åŒ–

```cpp
// åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®
{
    QList<double> tempX, tempY;
    calculateDTGDerivative(x, y, 50, 0.1, tempX, tempY);
    // ä½¿ç”¨tempXå’ŒtempY...
}  // è‡ªåŠ¨é‡Šæ”¾å†…å­˜
```

---

## ğŸ”¬ ç®—æ³•é€‰æ‹©å†³ç­–æ ‘

```
å¼€å§‹
  â”‚
  â”œâ”€ æ˜¯å¦äº†è§£æ•°æ®å™ªå£°æ°´å¹³ï¼Ÿ
  â”‚   â”œâ”€ å¦ â†’ ä½¿ç”¨ calculateAdaptiveDerivative() â­æ¨è
  â”‚   â””â”€ æ˜¯ â†“
  â”‚
  â”œâ”€ å™ªå£°æ°´å¹³å¦‚ä½•ï¼Ÿ
  â”‚   â”œâ”€ ä½å™ªå£°ï¼ˆSNR > 100ï¼‰
  â”‚   â”‚   â””â”€ ä½¿ç”¨ calculateCentralDifference() æˆ– calculateFivePointDifference()
  â”‚   â”‚
  â”‚   â”œâ”€ ä¸­å™ªå£°ï¼ˆSNR 20-100ï¼‰
  â”‚   â”‚   â””â”€ ä½¿ç”¨ calculateDTGDerivative(x, y, 25, 0.1, ...)
  â”‚   â”‚
  â”‚   â””â”€ é«˜å™ªå£°ï¼ˆSNR < 20ï¼‰
  â”‚       â”œâ”€ ä½¿ç”¨ calculateDTGDerivative(x, y, 50, 0.1, ...)
  â”‚       â””â”€ æˆ– calculateSmoothThenDifferentiate(x, y, 20, ...)
  â”‚
  â”œâ”€ æ˜¯å¦ä½¿ç”¨Qtå›¾è¡¨ï¼Ÿ
  â”‚   â””â”€ æ˜¯ â†’ ä½¿ç”¨ calculateDTGDerivativeFromPoints() â­æ¨è
  â”‚
  â””â”€ æ˜¯å¦éœ€è¦æŸ¥æ‰¾ç‰¹å¾ç‚¹ï¼Ÿ
      â””â”€ æ˜¯ â†’ å…ˆè®¡ç®—å¾®åˆ†ï¼Œå†ä½¿ç”¨ findMaxDerivativePoint() æˆ– findDerivativeExtrema()
```

---

## ğŸ“ å®Œæ•´åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å®Œæ•´çš„TGåˆ†ææµç¨‹

```cpp
#include "å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….h"

void analyzeTGData(const QString& filename)
{
    // 1. è¯»å–æ•°æ®
    QList<double> temperature, mass;
    // ... ä»æ–‡ä»¶è¯»å–æ•°æ®çš„ä»£ç  ...

    // 2. è®¡ç®—DTGå¾®åˆ†
    QList<double> dtgX, dtgY;
    if (!calculateDTGDerivative(temperature, mass, 50, 0.1, dtgX, dtgY)) {
        qDebug() << "å¾®åˆ†è®¡ç®—å¤±è´¥ï¼";
        return;
    }

    // 3. æŸ¥æ‰¾æœ€å¤§åˆ†è§£é€Ÿç‡ç‚¹
    double tMax, rateMax;
    if (findMaxDerivativePoint(dtgX, dtgY, tMax, rateMax)) {
        qDebug() << "=== ä¸»è¦åˆ†è§£ç‰¹å¾ ===";
        qDebug() << "æœ€å¤§åˆ†è§£æ¸©åº¦:" << tMax << "Â°C";
        qDebug() << "æœ€å¤§åˆ†è§£é€Ÿç‡:" << rateMax << "%/min";
    }

    // 4. æŸ¥æ‰¾æ‰€æœ‰åˆ†è§£é˜¶æ®µ
    QList<double> peakX, peakY, valleyX, valleyY;
    findDerivativeExtrema(dtgX, dtgY, 0.15, peakX, peakY, valleyX, valleyY);

    qDebug() << "\n=== åˆ†è§£é˜¶æ®µåˆ†æ ===";
    qDebug() << "å…±å‘ç°" << peakX.size() << "ä¸ªåˆ†è§£é˜¶æ®µ:";
    for (int i = 0; i < peakX.size(); ++i) {
        qDebug() << "é˜¶æ®µ" << (i+1) << ": æ¸©åº¦ =" << peakX[i]
                 << "Â°C, é€Ÿç‡ =" << peakY[i] << "%/min";
    }

    // 5. ç»˜åˆ¶å›¾è¡¨
    plotTGCurves(temperature, mass, dtgX, dtgY, peakX, peakY);
}
```

### ç¤ºä¾‹2: ä¸åŒå™ªå£°æ°´å¹³çš„å¤„ç†

```cpp
void processWithDifferentNoises()
{
    QList<double> x, y;
    // ... åŠ è½½æ•°æ® ...

    // ä¼°ç®—å™ªå£°
    double noise = estimateNoiseLevel(y);

    QList<double> derivX, derivY;

    if (noise < 0.01) {
        // ä½å™ªå£°ï¼šå¿«é€Ÿä¸­å¿ƒå·®åˆ†
        qDebug() << "æ£€æµ‹åˆ°ä½å™ªå£°ï¼Œä½¿ç”¨ä¸­å¿ƒå·®åˆ†";
        calculateCentralDifference(x, y, derivX, derivY);

    } else if (noise < 0.1) {
        // ä¸­å™ªå£°ï¼šä¸­ç­‰çª—å£DTG
        qDebug() << "æ£€æµ‹åˆ°ä¸­ç­‰å™ªå£°ï¼Œä½¿ç”¨DTG(25ç‚¹çª—å£)";
        calculateDTGDerivative(x, y, 25, 0.1, derivX, derivY);

    } else {
        // é«˜å™ªå£°ï¼šå¤§çª—å£æˆ–ä¸¤æ­¥æ³•
        qDebug() << "æ£€æµ‹åˆ°é«˜å™ªå£°ï¼Œä½¿ç”¨DTG(50ç‚¹çª—å£)";
        calculateDTGDerivative(x, y, 50, 0.1, derivX, derivY);
    }
}

// è¾…åŠ©å‡½æ•°ï¼šä¼°ç®—å™ªå£°
double estimateNoiseLevel(const QList<double>& data)
{
    if (data.size() < 10) return 0.0;

    QList<double> diffs;
    for (int i = 1; i < std::min(100, data.size()); ++i) {
        diffs.append(std::abs(data[i] - data[i-1]));
    }

    std::sort(diffs.begin(), diffs.end());
    return diffs[diffs.size() / 2];  // ä¸­ä½æ•°
}
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

1. **ç®—æ³•åŸç†**: è§"å¾®åˆ†ç®—æ³•åˆ†ææŠ¥å‘Š.md"
2. **æºä»£ç **: è§"å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….cpp"
3. **å‡½æ•°å£°æ˜**: è§"å¾®åˆ†ç®—æ³•å‡½æ•°å°è£….h"

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. âœ… æ•°æ®ç‚¹æ•°æ˜¯å¦è¶³å¤Ÿï¼ˆè‡³å°‘101ç‚¹å¯¹äºhalfWin=50ï¼‰
2. âœ… Xå’ŒYæ•°æ®é•¿åº¦æ˜¯å¦ä¸€è‡´
3. âœ… å‚æ•°æ˜¯å¦åˆç†ï¼ˆhalfWin > 0, dt > 0ç­‰ï¼‰
4. âœ… æ•°æ®æ˜¯å¦åŒ…å«æ— æ•ˆå€¼ï¼ˆNaN, Infï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-31
**é€‚ç”¨èŒƒå›´**: Qt 5.x / Qt 6.x
