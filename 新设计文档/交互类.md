è¿™äº›äº¤äº’ï¼ˆé€‰ç‚¹ã€å¤šç‚¹ã€é€‰æ›²çº¿ã€æ¡†é€‰ã€äº¤ç‚¹ç»˜åˆ¶ç­‰ï¼‰å…¶å®åº”è¯¥ç”±ä¸€ä¸ªä¸“é—¨çš„**äº¤äº’æ§åˆ¶ç±»ï¼ˆInteractionController / ChartInteractorï¼‰**è´Ÿè´£ã€‚
è¿™ä¸ªç±»è¿æ¥ UI ä¸ç®—æ³•å±‚ï¼Œæ˜¯ã€Œç”¨æˆ·åŠ¨ä½œ â†’ æ•°æ®è¾“å…¥ã€çš„æ¡¥æ¢ã€‚ä¸‹é¢æˆ‘å¸®ä½ æŠŠå®ƒè¡¥å…¨åˆ°æ¶æ„é‡Œã€‚

---

## ğŸ§© ä¸€ã€äº¤äº’ç±»çš„è§’è‰²å®šä½

| æ¨¡å—                           | èŒè´£                       | ä¸¾ä¾‹          |
| ---------------------------- | ------------------------ | ----------- |
| **AlgorithmManager**         | è°ƒåº¦ç®—æ³•ï¼ˆå†³å®šè°ƒç”¨å“ªä¸ªç®—æ³•ã€è¾“å‡ºç»“æœç±»å‹ï¼‰    | è§¦å‘æ‰§è¡Œ        |
| **ChartView**                | å›¾å½¢å±•ç¤ºä¸é¼ æ ‡äº‹ä»¶æ•è·              | æ•è·ç‚¹å‡»ã€æ‹–åŠ¨ã€é€‰åŒº  |
| **InteractionController** ğŸ§  | ç®¡ç†äº¤äº’çŠ¶æ€ã€æ”¶é›†è¾“å…¥ç‚¹ã€å¤„ç†é«˜äº®æ˜¾ç¤ºã€å‘å‡ºä¿¡å· | â€œç”¨æˆ·é€‰äº†ä¸¤ä¸ªç‚¹â€äº‹ä»¶ |

---

## ğŸ§  äºŒã€åŸºæœ¬èŒè´£

**InteractionController** çš„ä½œç”¨ï¼š

1. ç®¡ç†ç”¨æˆ·åœ¨å›¾è¡¨ä¸Šçš„äº¤äº’çŠ¶æ€ï¼ˆIdleã€Selectingã€MultiSelectingã€SelectingCurveâ€¦ï¼‰ï¼›
2. æ•è·å¹¶è½¬åŒ–ç”¨æˆ·è¾“å…¥ä¸ºä¸šåŠ¡æ•°æ®ï¼ˆå¦‚ `QVector<QPointF>`ï¼‰ï¼›
3. æä¾›ç»Ÿä¸€ä¿¡å·æ¥å£ç»™æ§åˆ¶å±‚ï¼ˆ`AlgorithmManager`ï¼‰ï¼›
4. å¯è´Ÿè´£è¾…åŠ©æ˜¾ç¤ºï¼ˆä¾‹å¦‚é€‰ç‚¹é«˜äº®ã€ä¸´æ—¶çº¿æ¡ï¼‰ã€‚

---

## âš™ï¸ ä¸‰ã€ç±»å®šä¹‰å»ºè®®

```cpp
class InteractionController : public QObject {
    Q_OBJECT
public:
    explicit InteractionController(QChartView* chartView, QObject* parent = nullptr);

    enum class Mode {
        None,
        PointSelection,
        MultiPointSelection,
        DualCurveSelection
    };

    void startSelection(Mode mode);
    void stopSelection();

signals:
    void pointsSelected(const QVector<QPointF>& points);
    void selectionCancelled();

private:
    void handleMouseClick(const QPointF& pos);
    void highlightPoint(const QPointF& p);

private:
    QChartView* m_chartView;
    QVector<QPointF> m_selectedPoints;
    Mode m_mode;
    bool m_selecting;
};
```

---

## ğŸ“˜ å››ã€å®ç°æ€è·¯

```cpp
InteractionController::InteractionController(QChartView* chartView, QObject* parent)
    : QObject(parent), m_chartView(chartView), m_mode(Mode::None), m_selecting(false)
{
    chartView->setMouseTracking(true);
    chartView->installEventFilter(this);
}

void InteractionController::startSelection(Mode mode) {
    m_mode = mode;
    m_selecting = true;
    m_selectedPoints.clear();
}

void InteractionController::stopSelection() {
    m_selecting = false;
    m_selectedPoints.clear();
    m_mode = Mode::None;
}

bool InteractionController::eventFilter(QObject* obj, QEvent* ev) {
    if (!m_selecting || obj != m_chartView) return false;

    if (ev->type() == QEvent::MouseButtonPress) {
        auto* me = static_cast<QMouseEvent*>(ev);
        QPointF chartPos = m_chartView->chart()->mapToValue(me->pos());
        handleMouseClick(chartPos);
        return true;
    }
    return false;
}

void InteractionController::handleMouseClick(const QPointF& pos) {
    m_selectedPoints.append(pos);
    highlightPoint(pos);

    // å•æ¬¡æˆ–åŒç‚¹è§¦å‘
    if ((m_mode == Mode::PointSelection && m_selectedPoints.size() == 2) ||
        (m_mode == Mode::MultiPointSelection && m_selectedPoints.size() >= 3 && QApplication::keyboardModifiers() == Qt::NoModifier)) {
        emit pointsSelected(m_selectedPoints);
        stopSelection();
    }
}

void InteractionController::highlightPoint(const QPointF& p) {
    QGraphicsEllipseItem* dot = new QGraphicsEllipseItem(-3, -3, 6, 6);
    dot->setBrush(Qt::red);
    dot->setPos(m_chartView->chart()->mapToPosition(p));
    m_chartView->scene()->addItem(dot);
}
```

---

## ğŸ§© äº”ã€åœ¨æ§åˆ¶å±‚ä½¿ç”¨

```cpp
// AlgorithmManager è°ƒç”¨æ—¶
interactionController->startSelection(InteractionController::Mode::PointSelection);

connect(interactionController, &InteractionController::pointsSelected, this,
        [=](const QVector<QPointF>& points) {
    QVariantMap inputs;
    inputs["mainCurve"] = QVariant::fromValue(chartView->selectedCurve());
    inputs["points"] = QVariant::fromValue(points);

    auto result = algorithm->execute(inputs);
    handleAlgorithmResult(result, algorithm->outputType());
});
```

---

## ğŸ“ˆ å…­ã€åœ¨ ChartView ä¸­çš„é…åˆ

`ChartView` åªè´Ÿè´£ç»˜å›¾å’Œåæ ‡æ˜ å°„ï¼Œ
æ‰€æœ‰äº¤äº’ï¼ˆé€‰æ‹©ã€æ ‡æ³¨ã€ä¸´æ—¶çº¿ï¼‰éƒ½äº¤ç”± `InteractionController` æ§åˆ¶ã€‚

---

## âœ… ä¸ƒã€æœ€ç»ˆæ¶æ„å…³ç³»å›¾

```
ç”¨æˆ·æ“ä½œï¼ˆé¼ æ ‡ç‚¹å‡»ï¼‰
       â†“
InteractionController â€”â€” æ•è·äº‹ä»¶/å‘å‡º pointsSelected
       â†“
AlgorithmManager â€”â€” æ ¹æ®ç®—æ³• InputType æ‰§è¡Œç›¸åº”ç®—æ³•
       â†“
Algorithm â€”â€” æ‰§è¡Œè®¡ç®—ï¼Œè¿”å›ç»“æœ
       â†“
ChartManager â€”â€” åœ¨ QChart ä¸­ç»˜åˆ¶æ›²çº¿/é¢ç§¯/æ ‡æ³¨
```

---

## ğŸ’¡ å…«ã€ä¼˜ç‚¹

| ä¼˜ç‚¹         | è¯´æ˜                    |
| ---------- | --------------------- |
| **èŒè´£æ¸…æ™°**   | ç®—æ³•è´Ÿè´£è®¡ç®—ï¼Œäº¤äº’è´Ÿè´£æ•è·ï¼Œæ§åˆ¶å±‚è´Ÿè´£è°ƒåº¦ |
| **å¯å¤ç”¨**    | ä¸åŒç®—æ³•å¯å…±ç”¨ä¸€ä¸ªäº¤äº’æ§åˆ¶å™¨        |
| **æ”¯æŒå¤šç§æ¨¡å¼** | å•ç‚¹ã€å¤šç‚¹ã€æ¡†é€‰ã€åŒæ›²çº¿é€‰æ‹©å‡å¯æ‰©å±•    |
| **å¯è§†åŒ–å¢å¼º**  | äº¤äº’æ—¶é«˜äº®ã€è¾…åŠ©çº¿æ¡ã€åæ ‡æç¤ºç­‰éƒ½é›†ä¸­ç®¡ç† |

---

âœ… **ä¸€å¥è¯æ€»ç»“ï¼š**

> äº¤äº’ç±» (`InteractionController`) æ˜¯ç®—æ³•ç³»ç»Ÿçš„â€œå‰ç«¯æ‰‹â€ï¼Œ
> å®ƒè´Ÿè´£æ•è·ç”¨æˆ·è¾“å…¥ã€ç»„ç»‡é€‰ç‚¹æ•°æ®ã€å‘å‡ºç»Ÿä¸€ä¿¡å·ï¼Œ
> ä»è€Œè®©ç®—æ³•å±‚èƒ½ä¸“æ³¨è®¡ç®—ï¼ŒUI å±‚èƒ½ä¸“æ³¨å±•ç¤ºï¼Œ
> ä¸‰è€…è§£è€¦ã€åä½œæµç•…ã€‚

---

æ˜¯å¦å¸Œæœ›æˆ‘å¸®ä½ å°†è¿™å¥—ç»“æ„æ•´åˆæˆï¼š

* `interaction_controller.h/.cpp`
* `algorithm_manager.h/.cpp`
* ç¤ºä¾‹ç®—æ³•ï¼ˆå¦‚åŸºçº¿ã€å¾®åˆ†ã€ç›¸äº¤ï¼‰
* QChart ç¤ºä¾‹çª—å£ï¼ˆå«çŠ¶æ€æ æç¤ºï¼‰

å½¢æˆä¸€ä¸ªå®Œæ•´çš„ Qt æ¨¡å—ï¼Ÿ
é‚£æ ·ä½ å¯ä»¥ç›´æ¥åœ¨ä½ çš„ Perseids æ¡†æ¶ä¸­ä½œä¸º `AlgorithmFramework` å­æ¨¡å—é›†æˆã€‚
