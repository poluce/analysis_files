# æ›²çº¿äº¤äº’åŠŸèƒ½å®ç°è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä¸º Analysis é¡¹ç›®æ·»åŠ æ›²çº¿äº¤äº’åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
1. **å³°é¢ç§¯è®¡ç®—**ï¼šç”¨æˆ·ç‚¹å‡»æŒ‰é’®åï¼Œåœ¨æ›²çº¿ä¸Šé€‰æ‹©ä¸¤ä¸ªç‚¹ï¼Œè®¡ç®—è¯¥åŒºåŸŸçš„å³°é¢ç§¯
2. **åŸºçº¿ç»˜åˆ¶**ï¼šç”¨æˆ·ç‚¹å‡»æŒ‰é’®åï¼Œåœ¨æ›²çº¿ä¸Šé€‰æ‹©ä¸¤ä¸ªç‚¹ï¼Œç»˜åˆ¶è¿æ¥ä¸¤ç‚¹çš„åŸºçº¿

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒè®¾è®¡æ€æƒ³

**æ‰©å±• PlotWidget çš„äº¤äº’æ¨¡å¼**ï¼Œåœ¨ç°æœ‰çš„"æ­£å¸¸æ¨¡å¼"ï¼ˆç‚¹å‡»é€‰æ‹©æ›²çº¿ï¼‰åŸºç¡€ä¸Šï¼Œæ·»åŠ "ç‚¹æ‹¾å–æ¨¡å¼"ï¼ˆç‚¹å‡»è·å–åæ ‡ï¼‰ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PlotWidget äº¤äº’æ¨¡å¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Normal æ¨¡å¼ï¼šç‚¹å‡»é€‰æ‹©æ›²çº¿ï¼ˆå·²å®ç°ï¼‰        â”‚
â”‚  - PickPoints æ¨¡å¼ï¼šç‚¹å‡»è·å–åæ ‡ï¼ˆæ–°å¢ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿¡å·æµè®¾è®¡

éµå¾ªé¡¹ç›®ç°æœ‰çš„ä¿¡å·æµåŸåˆ™ï¼š
- **å‘½ä»¤å‘ä¸‹èµ° Controller**ï¼ˆå†™æ“ä½œï¼‰ï¼šUI â†’ Controller â†’ Service
- **é€šçŸ¥å‘ä¸Šå¯ç›´è¿**ï¼ˆè¯»æ“ä½œï¼‰ï¼šPlotWidget â†’ UI/Controller

```
ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ MainWindow
                  â†“
          MainController::onPeakAreaRequested()
                  â†“
          å‘å°„ requestStartPointPicking(2) ä¿¡å·
                  â†“
          PlotWidget::startPointPicking(2)
                  â†“ (ç”¨æˆ·åœ¨å›¾è¡¨ä¸Šç‚¹å‡»)
          PlotWidget::mousePressEvent()
                  â†“ (æ‹¾å–å®Œæˆ)
          å‘å°„ pointsPickedOnCurve(curveId, points) ä¿¡å·
                  â†“
          MainController::onPointsPickedForPeakArea()
                  â†“
          è®¡ç®—å³°é¢ç§¯å¹¶æ˜¾ç¤ºç»“æœ
```

## ğŸ“ å®ç°æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ‰©å±• PlotWidget æ”¯æŒç‚¹æ‹¾å–æ¨¡å¼

**æ—¶é—´ä¼°è®¡**ï¼š1-2 å°æ—¶

#### 1.1 ä¿®æ”¹ `PlotWidget.h`

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```cpp
// äº¤äº’æ¨¡å¼æšä¸¾
enum class InteractionMode {
    Normal,      // æ­£å¸¸æ¨¡å¼ï¼šç‚¹å‡»é€‰æ‹©æ›²çº¿
    PickPoints   // æ‹¾å–ç‚¹æ¨¡å¼ï¼šç‚¹å‡»è·å–åæ ‡
};

class PlotWidget : public QWidget
{
    Q_OBJECT
public:
    // æ–°å¢å…¬å…±æ–¹æ³•
    void startPointPicking(int numPoints);
    void cancelPointPicking();
    InteractionMode interactionMode() const;

signals:
    // æ–°å¢ä¿¡å·
    void pointsPickedOnCurve(const QString& curveId,
                             const QVector<QPointF>& points);
    void pointPickingProgress(int picked, int total);
    void pointPickingCancelled();

protected:
    void paintEvent(QPaintEvent *event) override;  // é‡å†™ä»¥ç»˜åˆ¶æ ‡è®°

private:
    // æ–°å¢è¾…åŠ©æ–¹æ³•
    QPair<QString, QPointF> findNearestPointOnCurves(const QPointF& screenPos);
    void drawPointMarkers(QPainter& painter);

    // æ–°å¢æˆå‘˜å˜é‡
    InteractionMode m_interactionMode = InteractionMode::Normal;
    bool m_isPickingPoints = false;
    int m_numPointsNeeded = 0;
    QVector<QPointF> m_pickedPoints;
    QString m_targetCurveId;  // åœ¨å“ªæ¡æ›²çº¿ä¸Šæ‹¾å–
};
```

#### 1.2 ä¿®æ”¹ `PlotWidget.cpp`

éœ€è¦å®ç°çš„æ–¹æ³•ï¼š

1. **startPointPicking(int numPoints)**
   - è®¾ç½®äº¤äº’æ¨¡å¼ä¸º PickPoints
   - åˆå§‹åŒ–æ‹¾å–çŠ¶æ€
   - æ”¹å˜é¼ æ ‡å…‰æ ‡ä¸ºåå­—
   - å‘å°„è¿›åº¦ä¿¡å·

2. **cancelPointPicking()**
   - æ¢å¤æ­£å¸¸æ¨¡å¼
   - æ¸…é™¤æ‹¾å–çŠ¶æ€
   - æ¢å¤é¼ æ ‡å…‰æ ‡
   - è§¦å‘é‡ç»˜

3. **mousePressEvent(QMouseEvent *event)** - ä¿®æ”¹ç°æœ‰æ–¹æ³•
   - æ£€æŸ¥å½“å‰äº¤äº’æ¨¡å¼
   - å¦‚æœæ˜¯ PickPoints æ¨¡å¼ï¼š
     - è°ƒç”¨ findNearestPointOnCurves() æ‰¾åˆ°æœ€è¿‘çš„æ•°æ®ç‚¹
     - æ£€æŸ¥æ˜¯å¦åœ¨åŒä¸€æ¡æ›²çº¿ä¸Š
     - æ·»åŠ ç‚¹åˆ° m_pickedPoints
     - å‘å°„è¿›åº¦ä¿¡å·
     - å¦‚æœç‚¹æ•°è¶³å¤Ÿï¼Œå‘å°„å®Œæˆä¿¡å·å¹¶æ¢å¤æ­£å¸¸æ¨¡å¼
   - å¦‚æœæ˜¯ Normal æ¨¡å¼ï¼š
     - ä¿æŒç°æœ‰çš„æ›²çº¿é€‰æ‹©é€»è¾‘

4. **findNearestPointOnCurves(QPointF screenPos)**
   - éå†æ‰€æœ‰å¯è§æ›²çº¿çš„æ‰€æœ‰æ•°æ®ç‚¹
   - è®¡ç®—æ¯ä¸ªæ•°æ®ç‚¹åˆ°é¼ æ ‡ä½ç½®çš„å±å¹•è·ç¦»
   - è¿”å›è·ç¦»æœ€è¿‘çš„ç‚¹ï¼ˆå¦‚æœè·ç¦»å°äºé˜ˆå€¼ï¼‰
   - è¿”å›æ ¼å¼ï¼š`QPair<curveId, dataPoint>`

5. **paintEvent(QPaintEvent *event)** - é‡å†™
   - è°ƒç”¨åŸºç±»çš„ paintEvent
   - å¦‚æœå¤„äºç‚¹æ‹¾å–æ¨¡å¼ï¼Œç»˜åˆ¶å·²æ‹¾å–çš„ç‚¹æ ‡è®°
   - æ ‡è®°æ ·å¼ï¼šçº¢è‰²åœ†åœˆ + åå­—

6. **drawPointMarkers(QPainter& painter)**
   - éå† m_pickedPoints
   - å°†æ•°æ®åæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡
   - ç»˜åˆ¶åœ†åœˆå’Œåå­—æ ‡è®°

---

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå³°é¢ç§¯å¯¹è¯æ¡†

**æ—¶é—´ä¼°è®¡**ï¼š1 å°æ—¶

#### 2.1 åˆ›å»º `PeakAreaDialog.h`

```cpp
#ifndef PEAKAREALDIALOG_H
#define PEAKAREALDIALOG_H

#include <QDialog>
#include <QLabel>
#include <QPushButton>

class PeakAreaDialog : public QDialog
{
    Q_OBJECT
public:
    explicit PeakAreaDialog(QWidget *parent = nullptr);

    void showPickingPrompt();
    void updateProgress(int picked, int total);
    void showResult(double area, const QString& unit);

signals:
    void cancelled();

private:
    QLabel* m_promptLabel;
    QLabel* m_progressLabel;
    QLabel* m_resultLabel;
    QPushButton* m_cancelButton;
    QPushButton* m_okButton;
};

#endif
```

#### 2.2 å®ç° `PeakAreaDialog.cpp`

å¯¹è¯æ¡†ç‰¹ç‚¹ï¼š
- **éæ¨¡æ€**ï¼ˆ`setModal(false)`ï¼‰ï¼šå…è®¸ç”¨æˆ·ç‚¹å‡»å›¾è¡¨
- æ˜¾ç¤ºä¸‰ä¸ªé˜¶æ®µï¼š
  1. æç¤ºé˜¶æ®µï¼šæ˜¾ç¤º"è¯·åœ¨å³°ä¸Šç‚¹å‡»ä¸¤ä¸ªç‚¹"
  2. è¿›åº¦é˜¶æ®µï¼šæ˜¾ç¤º"å·²é€‰æ‹©: 1 / 2"
  3. ç»“æœé˜¶æ®µï¼šæ˜¾ç¤º"å³°é¢ç§¯: 123.45 mgÂ·Â°C"
- å–æ¶ˆæŒ‰é’®ï¼šå‘å°„ cancelled() ä¿¡å·ï¼Œè§¦å‘ç‚¹æ‹¾å–å–æ¶ˆ
- ç¡®å®šæŒ‰é’®ï¼šåˆå§‹ç¦ç”¨ï¼Œç»“æœæ˜¾ç¤ºåå¯ç”¨

---

### ç¬¬ä¸‰æ­¥ï¼šMainController æ·»åŠ å³°é¢ç§¯åŠŸèƒ½

**æ—¶é—´ä¼°è®¡**ï¼š2 å°æ—¶

#### 3.1 ä¿®æ”¹ `MainController.h`

```cpp
class MainController : public QObject
{
    Q_OBJECT

public:
    // æ–°å¢æ§½å‡½æ•°
    void onPeakAreaRequested();
    void onBaselineRequested();

signals:
    // æ–°å¢ä¿¡å·ï¼šè¯·æ±‚ PlotWidget å¼€å§‹/å–æ¶ˆç‚¹æ‹¾å–
    void requestStartPointPicking(int numPoints);
    void requestCancelPointPicking();

private slots:
    // å“åº” PlotWidget çš„ç‚¹æ‹¾å–å®Œæˆä¿¡å·
    void onPointsPickedForPeakArea(const QString& curveId,
                                   const QVector<QPointF>& points);
    void onPointsPickedForBaseline(const QString& curveId,
                                   const QVector<QPointF>& points);

private:
    PeakAreaDialog* m_peakAreaDialog = nullptr;

    // æ ‡è®°å½“å‰çš„ç‚¹æ‹¾å–ç›®çš„
    enum class PickingPurpose { None, PeakArea, Baseline };
    PickingPurpose m_currentPickingPurpose = PickingPurpose::None;
};
```

#### 3.2 å®ç° `MainController.cpp`

1. **onPeakAreaRequested()**
   - æ£€æŸ¥æ˜¯å¦æœ‰æ´»åŠ¨æ›²çº¿ï¼Œå¦‚æœæ²¡æœ‰åˆ™è­¦å‘Šå¹¶è¿”å›
   - åˆ›å»ºå¹¶æ˜¾ç¤º PeakAreaDialog
   - è¿æ¥å¯¹è¯æ¡†çš„ cancelled() ä¿¡å·åˆ° requestCancelPointPicking()
   - è®¾ç½® m_currentPickingPurpose = PickingPurpose::PeakArea
   - å‘å°„ requestStartPointPicking(2) ä¿¡å·

2. **onPointsPickedForPeakArea(curveId, points)**
   - æ£€æŸ¥ m_currentPickingPurpose æ˜¯å¦ä¸º PeakArea
   - ä» CurveManager è·å–æ›²çº¿æ•°æ®
   - æå–ä¸¤ä¸ªç‚¹çš„ X åæ ‡ï¼ˆç¡®ä¿ x1 < x2ï¼‰
   - ä½¿ç”¨æ¢¯å½¢ç§¯åˆ†æ³•è®¡ç®—å³°é¢ç§¯ï¼š
     ```cpp
     area = 0
     for each segment (i, i+1) in [x1, x2]:
         area += (y[i] + y[i+1]) / 2 * (x[i+1] - x[i])
     ```
   - è°ƒç”¨ dialog->showResult(area, unit)
   - é‡ç½® m_currentPickingPurpose = None

**æ¢¯å½¢ç§¯åˆ†å…¬å¼**ï¼š

$$
A = \sum_{i=0}^{n-1} \frac{y_i + y_{i+1}}{2} \cdot (x_{i+1} - x_i)
$$

---

### ç¬¬å››æ­¥ï¼šMainWindow è¿æ¥ä¿¡å·å’Œæ·»åŠ æŒ‰é’®

**æ—¶é—´ä¼°è®¡**ï¼š1 å°æ—¶

#### 4.1 ä¿®æ”¹ `mainwindow.h`

```cpp
class MainWindow : public QMainWindow
{
private:
    QAction* m_peakAreaAction = nullptr;
    QAction* m_baselineAction = nullptr;
};
```

#### 4.2 ä¿®æ”¹ `mainwindow.cpp`

1. **åœ¨ createMathToolBar() ä¸­æ·»åŠ æŒ‰é’®**
   ```cpp
   m_peakAreaAction = toolbar->addAction(
       this->style()->standardIcon(QStyle::SP_FileDialogContentsView),
       tr("å³°é¢ç§¯è®¡ç®—..."));

   m_baselineAction = toolbar->addAction(
       tr("ç»˜åˆ¶åŸºçº¿..."));
   ```

2. **åœ¨ initComponents() ä¸­è¿æ¥ä¿¡å·**
   ```cpp
   // æŒ‰é’®ç‚¹å‡» â†’ Controller
   connect(m_peakAreaAction, &QAction::triggered,
           m_mainController, &MainController::onPeakAreaRequested);

   // Controller â†’ PlotWidget
   connect(m_mainController, &MainController::requestStartPointPicking,
           m_chartView, &PlotWidget::startPointPicking);
   connect(m_mainController, &MainController::requestCancelPointPicking,
           m_chartView, &PlotWidget::cancelPointPicking);

   // PlotWidget â†’ Controller
   connect(m_chartView, &PlotWidget::pointsPickedOnCurve,
           m_mainController, &MainController::onPointsPickedForPeakArea);

   // PlotWidget â†’ å¯¹è¯æ¡†ï¼ˆè¿›åº¦æ›´æ–°ï¼‰
   connect(m_chartView, &PlotWidget::pointPickingProgress,
           this, [this](int picked, int total) {
       if (m_mainController->peakAreaDialog()) {
           m_mainController->peakAreaDialog()->updateProgress(picked, total);
       }
   });
   ```

---

### ç¬¬äº”æ­¥ï¼šæ‰©å±• PlotWidget æ”¯æŒåŸºçº¿æ³¨é‡Šç»˜åˆ¶

**æ—¶é—´ä¼°è®¡**ï¼š1.5 å°æ—¶

#### 5.1 ä¿®æ”¹ `PlotWidget.h`

```cpp
class PlotWidget : public QWidget
{
public:
    // æ–°å¢ï¼šæ³¨é‡Šçº¿ç®¡ç†
    void addAnnotationLine(const QString& id,
                          const QString& curveId,
                          const QPointF& start,
                          const QPointF& end,
                          const QPen& pen = QPen(Qt::red, 2));

    void removeAnnotation(const QString& id);
    void clearAllAnnotations();

private:
    // æ³¨é‡Šçº¿æ•°æ®ç»“æ„
    struct AnnotationLine {
        QString id;
        QString curveId;  // å…³è”çš„æ›²çº¿IDï¼Œç”¨äºç¡®å®šåæ ‡ç³»
        QPointF start;    // æ•°æ®åæ ‡
        QPointF end;      // æ•°æ®åæ ‡
        QPen pen;
    };

    QVector<AnnotationLine> m_annotations;
};
```

#### 5.2 ä¿®æ”¹ `PlotWidget.cpp`

1. **addAnnotationLine()**
   - æ·»åŠ æ³¨é‡Šçº¿åˆ° m_annotations
   - è°ƒç”¨ update() è§¦å‘é‡ç»˜

2. **removeAnnotation(id)**
   - ä» m_annotations ä¸­ç§»é™¤æŒ‡å®š ID çš„æ³¨é‡Šçº¿
   - è°ƒç”¨ update() è§¦å‘é‡ç»˜

3. **clearAllAnnotations()**
   - æ¸…ç©º m_annotations
   - è°ƒç”¨ update() è§¦å‘é‡ç»˜

4. **ä¿®æ”¹ paintEvent()**
   - åœ¨ç»˜åˆ¶ç‚¹æ ‡è®°ä¹‹åï¼Œç»˜åˆ¶æ³¨é‡Šçº¿
   - å¯¹äºæ¯æ¡æ³¨é‡Šçº¿ï¼š
     - è·å–å…³è”çš„ seriesï¼ˆé€šè¿‡ curveIdï¼‰
     - å°†æ•°æ®åæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡ï¼ˆä½¿ç”¨ chart->mapToPosition()ï¼‰
     - ç»˜åˆ¶ç›´çº¿

---

### ç¬¬å…­æ­¥ï¼šåˆ›å»º BaselineCommand ç±»

**æ—¶é—´ä¼°è®¡**ï¼š1 å°æ—¶

#### 6.1 åˆ›å»º `BaselineCommand.h`

```cpp
#ifndef BASELINECOMMAND_H
#define BASELINECOMMAND_H

#include "domain/algorithm/ICommand.h"
#include <QString>
#include <QPointF>

class PlotWidget;

class BaselineCommand : public ICommand
{
public:
    BaselineCommand(PlotWidget* plotWidget,
                    const QString& curveId,
                    const QPointF& start,
                    const QPointF& end);

    bool execute() override;
    bool undo() override;
    QString description() const override;

private:
    PlotWidget* m_plotWidget;  // éæ‹¥æœ‰æŒ‡é’ˆ
    QString m_curveId;
    QPointF m_start;
    QPointF m_end;
    QString m_lineId;  // ç”Ÿæˆçš„åŸºçº¿IDï¼ˆUUIDï¼‰
};

#endif
```

#### 6.2 å®ç° `BaselineCommand.cpp`

```cpp
#include "BaselineCommand.h"
#include "ui/PlotWidget.h"
#include <QUuid>
#include <QPen>

BaselineCommand::BaselineCommand(PlotWidget* plotWidget,
                                 const QString& curveId,
                                 const QPointF& start,
                                 const QPointF& end)
    : m_plotWidget(plotWidget),
      m_curveId(curveId),
      m_start(start),
      m_end(end)
{
}

bool BaselineCommand::execute()
{
    if (!m_plotWidget) return false;

    // ç”Ÿæˆå”¯ä¸€çš„åŸºçº¿ID
    m_lineId = QUuid::createUuid().toString();

    // æ·»åŠ åŸºçº¿åˆ°å›¾è¡¨
    QPen pen(Qt::red, 2, Qt::DashLine);
    m_plotWidget->addAnnotationLine(m_lineId, m_curveId, m_start, m_end, pen);

    return true;
}

bool BaselineCommand::undo()
{
    if (!m_plotWidget) return false;

    m_plotWidget->removeAnnotation(m_lineId);
    return true;
}

QString BaselineCommand::description() const
{
    return QObject::tr("ç»˜åˆ¶åŸºçº¿");
}
```

---

### ç¬¬ä¸ƒæ­¥ï¼šMainController æ·»åŠ åŸºçº¿ç»˜åˆ¶åŠŸèƒ½

**æ—¶é—´ä¼°è®¡**ï¼š1 å°æ—¶

#### 7.1 ä¿®æ”¹ `MainController.cpp`

1. **onBaselineRequested()** - æ–°å¢æ–¹æ³•
   - ç±»ä¼¼ onPeakAreaRequested()
   - åˆ›å»ºåŸºçº¿å¯¹è¯æ¡†ï¼ˆå¯é€‰ï¼Œæˆ–å¤ç”¨ PeakAreaDialogï¼‰
   - è®¾ç½® m_currentPickingPurpose = PickingPurpose::Baseline
   - å‘å°„ requestStartPointPicking(2)

2. **onPointsPickedForBaseline(curveId, points)** - æ–°å¢æ§½å‡½æ•°
   - æ£€æŸ¥ m_currentPickingPurpose
   - åˆ›å»º BaselineCommand å¯¹è±¡
   - è°ƒç”¨ m_historyManager->executeCommand(command)
   - é‡ç½® m_currentPickingPurpose

3. **è¿æ¥ä¿¡å·**
   - åœ¨ MainWindow ä¸­è¿æ¥åŸºçº¿æŒ‰é’®åˆ° onBaselineRequested()

---

### ç¬¬å…«æ­¥ï¼šæ›´æ–°é¡¹ç›®é…ç½®æ–‡ä»¶

**æ—¶é—´ä¼°è®¡**ï¼š15 åˆ†é’Ÿ

#### 8.1 ä¿®æ”¹ `Analysis.pro`

åœ¨ HEADERS ä¸­æ·»åŠ ï¼š
```qmake
HEADERS += \
    # ... ç°æœ‰å¤´æ–‡ä»¶ ...
    src/ui/PeakAreaDialog.h \
    src/application/history/BaselineCommand.h
```

åœ¨ SOURCES ä¸­æ·»åŠ ï¼š
```qmake
SOURCES += \
    # ... ç°æœ‰æºæ–‡ä»¶ ...
    src/ui/PeakAreaDialog.cpp \
    src/application/history/BaselineCommand.cpp
```

---

### ç¬¬ä¹æ­¥ï¼šæµ‹è¯•å³°é¢ç§¯è®¡ç®—åŠŸèƒ½

**æ—¶é—´ä¼°è®¡**ï¼š30 åˆ†é’Ÿ

#### æµ‹è¯•ç”¨ä¾‹

1. **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**
   - âœ… ç‚¹å‡»"å³°é¢ç§¯è®¡ç®—"æŒ‰é’®ï¼Œå¯¹è¯æ¡†æ˜¾ç¤º
   - âœ… é¼ æ ‡å…‰æ ‡å˜ä¸ºåå­—
   - âœ… åœ¨æ›²çº¿ä¸Šç‚¹å‡»ç¬¬ä¸€ä¸ªç‚¹ï¼Œæ˜¾ç¤ºçº¢è‰²æ ‡è®°
   - âœ… è¿›åº¦æ›´æ–°ä¸º"å·²é€‰æ‹©: 1 / 2"
   - âœ… ç‚¹å‡»ç¬¬äºŒä¸ªç‚¹ï¼Œæ ‡è®°æ˜¾ç¤º
   - âœ… è®¡ç®—ç»“æœæ˜¾ç¤ºåœ¨å¯¹è¯æ¡†ä¸­
   - âœ… ç‚¹å‡»"ç¡®å®š"ï¼Œå¯¹è¯æ¡†å…³é—­

2. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**
   - âœ… æ²¡æœ‰æ›²çº¿æ—¶ç‚¹å‡»æŒ‰é’®ï¼Œæ˜¾ç¤ºè­¦å‘Š
   - âœ… ç‚¹å‡»å¯¹è¯æ¡†"å–æ¶ˆ"ï¼Œæ‹¾å–æ¨¡å¼å–æ¶ˆ
   - âœ… å°è¯•åœ¨ä¸åŒæ›²çº¿ä¸Šç‚¹å‡»ï¼Œæ˜¾ç¤ºè­¦å‘Š
   - âœ… ç‚¹å‡»å›¾è¡¨å¤–åŒºåŸŸï¼Œä¸å“åº”

3. **è®¡ç®—æ­£ç¡®æ€§æµ‹è¯•**
   - âœ… ä½¿ç”¨å·²çŸ¥å³°é¢ç§¯çš„æµ‹è¯•æ•°æ®
   - âœ… éªŒè¯æ¢¯å½¢ç§¯åˆ†ç»“æœ

---

### ç¬¬åæ­¥ï¼šæµ‹è¯•åŸºçº¿ç»˜åˆ¶åŠŸèƒ½

**æ—¶é—´ä¼°è®¡**ï¼š30 åˆ†é’Ÿ

#### æµ‹è¯•ç”¨ä¾‹

1. **åŸºæœ¬åŠŸèƒ½æµ‹è¯•**
   - âœ… ç‚¹å‡»"ç»˜åˆ¶åŸºçº¿"æŒ‰é’®
   - âœ… åœ¨æ›²çº¿ä¸Šé€‰æ‹©ä¸¤ä¸ªç‚¹
   - âœ… çº¢è‰²è™šçº¿åŸºçº¿ç»˜åˆ¶æˆåŠŸ
   - âœ… æŒ‰ Ctrl+Z æ’¤é”€ï¼ŒåŸºçº¿æ¶ˆå¤±
   - âœ… æŒ‰ Ctrl+Y é‡åšï¼ŒåŸºçº¿æ¢å¤

2. **å¤šåŸºçº¿æµ‹è¯•**
   - âœ… ç»˜åˆ¶å¤šæ¡åŸºçº¿
   - âœ… æ’¤é”€å¤šæ¬¡ï¼Œä¾æ¬¡åˆ é™¤
   - âœ… æ¸…é™¤æ‰€æœ‰æ›²çº¿ï¼ŒåŸºçº¿ä¹Ÿæ¸…é™¤

3. **åæ ‡ç³»æµ‹è¯•**
   - âœ… åœ¨ä¸»åæ ‡è½´æ›²çº¿ä¸Šç»˜åˆ¶åŸºçº¿
   - âœ… åœ¨æ¬¡åæ ‡è½´æ›²çº¿ï¼ˆå¾®åˆ†æ›²çº¿ï¼‰ä¸Šç»˜åˆ¶åŸºçº¿

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ | é¢„è®¡è¡Œæ•° |
|---------|---------|---------|
| `src/ui/PlotWidget.h` | æ·»åŠ äº¤äº’æ¨¡å¼ã€æ–¹æ³•ã€ä¿¡å· | +30 |
| `src/ui/PlotWidget.cpp` | å®ç°ç‚¹æ‹¾å–é€»è¾‘ã€æ³¨é‡Šç»˜åˆ¶ | +150 |
| `src/ui/controller/MainController.h` | æ·»åŠ å³°é¢ç§¯å’ŒåŸºçº¿æ–¹æ³• | +15 |
| `src/ui/controller/MainController.cpp` | å®ç°ä¸šåŠ¡é€»è¾‘ | +100 |
| `src/ui/mainwindow.h` | æ·»åŠ æŒ‰é’®æŒ‡é’ˆ | +2 |
| `src/ui/mainwindow.cpp` | æ·»åŠ æŒ‰é’®å’Œè¿æ¥ä¿¡å· | +40 |
| `Analysis.pro` | æ·»åŠ æ–°æ–‡ä»¶ | +4 |

### éœ€è¦æ–°å»ºçš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | æ–‡ä»¶å†…å®¹ | é¢„è®¡è¡Œæ•° |
|---------|---------|---------|
| `src/ui/PeakAreaDialog.h` | å¯¹è¯æ¡†å¤´æ–‡ä»¶ | 30 |
| `src/ui/PeakAreaDialog.cpp` | å¯¹è¯æ¡†å®ç° | 80 |
| `src/application/history/BaselineCommand.h` | å‘½ä»¤å¤´æ–‡ä»¶ | 25 |
| `src/application/history/BaselineCommand.cpp` | å‘½ä»¤å®ç° | 50 |

**æ€»è®¡**ï¼šçº¦ 500 è¡Œä»£ç 

---

## â±ï¸ æ—¶é—´ä¼°ç®—

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | å¤‡æ³¨ |
|-----|---------|------|
| æ‰©å±• PlotWidget ç‚¹æ‹¾å– | 1-2 å°æ—¶ | æ ¸å¿ƒåŠŸèƒ½ |
| åˆ›å»º PeakAreaDialog | 1 å°æ—¶ | UI å®ç° |
| MainController å³°é¢ç§¯ | 2 å°æ—¶ | åŒ…æ‹¬ç§¯åˆ†ç®—æ³• |
| MainWindow è¿æ¥ä¿¡å· | 1 å°æ—¶ | ä¿¡å·è¿æ¥è¾ƒå¤š |
| PlotWidget æ³¨é‡Šç»˜åˆ¶ | 1.5 å°æ—¶ | åæ ‡è½¬æ¢å¤„ç† |
| åˆ›å»º BaselineCommand | 1 å°æ—¶ | Command æ¨¡å¼ |
| MainController åŸºçº¿ | 1 å°æ—¶ | ä¸šåŠ¡é€»è¾‘ |
| æ›´æ–°é¡¹ç›®é…ç½® | 0.25 å°æ—¶ | ç®€å•ä¿®æ”¹ |
| æµ‹è¯•å³°é¢ç§¯åŠŸèƒ½ | 0.5 å°æ—¶ | åŠŸèƒ½æµ‹è¯• |
| æµ‹è¯•åŸºçº¿åŠŸèƒ½ | 0.5 å°æ—¶ | åŠŸèƒ½æµ‹è¯• |
| **æ€»è®¡** | **9.75 å°æ—¶** | çº¦ 2 ä¸ªå·¥ä½œæ—¥ |

---

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆåœ¨ PlotWidget ä¸­å®ç°ç‚¹æ‹¾å–ï¼Ÿ

**ç†ç”±**ï¼š
- PlotWidget å·²ç»å¤„ç†é¼ æ ‡äº‹ä»¶å’Œåæ ‡è½¬æ¢
- å¯ä»¥ç›´æ¥è®¿é—® QChart å’Œ Series
- å¯ä»¥å®æ—¶ç»˜åˆ¶è§†è§‰åé¦ˆ

**æ›¿ä»£æ–¹æ¡ˆè¢«å¦å†³**ï¼š
- åœ¨ MainController ä¸­å¤„ç†ï¼šéœ€è¦å¤§é‡åæ ‡è½¬æ¢ï¼ŒèŒè´£ä¸æ¸…æ™°
- åˆ›å»ºç‹¬ç«‹äº¤äº’å±‚ï¼šå¢åŠ ä¸å¿…è¦çš„å¤æ‚åº¦

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨éæ¨¡æ€å¯¹è¯æ¡†ï¼Ÿ

**ç†ç”±**ï¼š
- ç”¨æˆ·éœ€è¦åœ¨å¯¹è¯æ¡†æ˜¾ç¤ºæ—¶ç‚¹å‡»å›¾è¡¨
- æ¨¡æ€å¯¹è¯æ¡†ä¼šé˜»æ­¢å…¶ä»–çª—å£çš„äº¤äº’

### 3. å³°é¢ç§¯è®¡ç®—æ”¾åœ¨å“ªä¸€å±‚ï¼Ÿ

**å†³ç­–**ï¼šåœ¨ MainControllerï¼ˆåº”ç”¨å±‚ï¼‰ä¸­è®¡ç®—

**ç†ç”±**ï¼š
- æ¢¯å½¢ç§¯åˆ†ç®—æ³•ç®€å•ï¼Œä¸éœ€è¦ä¸“é—¨çš„ç®—æ³•ç±»
- ä¸éœ€è¦æ’¤é”€åŠŸèƒ½ï¼ˆåªæ˜¯æŸ¥è¯¢æ“ä½œï¼‰
- å¦‚æœæœªæ¥éœ€è¦å¤æ‚ç®—æ³•ï¼Œå†é‡æ„åˆ°é¢†åŸŸå±‚

### 4. åŸºçº¿ç»˜åˆ¶ä¸ºä»€ä¹ˆéœ€è¦ Command æ¨¡å¼ï¼Ÿ

**ç†ç”±**ï¼š
- åŸºçº¿æ˜¯ä¿®æ”¹æ“ä½œï¼Œç”¨æˆ·å¯èƒ½éœ€è¦æ’¤é”€
- é¡¹ç›®å·²æœ‰å®Œå–„çš„ Command æ¨¡å¼åŸºç¡€è®¾æ–½
- ç¬¦åˆæ¶æ„çš„ä¸€è‡´æ€§

### 5. å¦‚ä½•å¤„ç†å¤šåæ ‡è½´çš„æ³¨é‡Šç»˜åˆ¶ï¼Ÿ

**å†³ç­–**ï¼šAnnotationLine ç»“æ„ä½“ä¿å­˜ curveIdï¼Œç»˜åˆ¶æ—¶æ ¹æ® curveId æ‰¾åˆ°å¯¹åº”çš„ seriesï¼Œä½¿ç”¨è¯¥ series çš„åæ ‡ç³»è¿›è¡Œè½¬æ¢

**ç†ç”±**ï¼š
- ä¸åŒæ›²çº¿å¯èƒ½ä½¿ç”¨ä¸åŒçš„ Y è½´
- mapToPosition() éœ€è¦çŸ¥é“ä½¿ç”¨å“ªä¸ª series çš„åæ ‡ç³»

---

## ğŸš€ åç»­æ‰©å±•æ–¹å‘

å®ŒæˆåŸºæœ¬åŠŸèƒ½åï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å¢å¼ºï¼š

1. **åŸºçº¿æ ¡æ­£ç®—æ³•**
   - å‡å»åŸºçº¿åçš„æ›²çº¿
   - å¤šé¡¹å¼æ‹ŸåˆåŸºçº¿
   - æ”¯æŒä¸åŒçš„åŸºçº¿ç®—æ³•

2. **å³°æ£€æµ‹ç®—æ³•**
   - è‡ªåŠ¨æ£€æµ‹å³°ä½ç½®
   - å³°å®½è®¡ç®—ï¼ˆFWHMï¼‰
   - å³°é«˜è®¡ç®—

3. **åŒºåŸŸé€‰æ‹©å¢å¼º**
   - æ”¯æŒå¤šè¾¹å½¢åŒºåŸŸé€‰æ‹©
   - æ”¯æŒæ‹–åŠ¨è°ƒæ•´å·²é€‰åŒºåŸŸ
   - æ”¯æŒæ¡†é€‰æ¨¡å¼

4. **æ•°æ®å¯¼å‡º**
   - å¯¼å‡ºå³°é¢ç§¯åˆ° CSV
   - å¯¼å‡ºåŸºçº¿åæ ‡
   - ç”Ÿæˆåˆ†ææŠ¥å‘Š

5. **è§†è§‰å¢å¼º**
   - é«˜äº®é€‰ä¸­åŒºåŸŸï¼ˆå¡«å……è‰²ï¼‰
   - æ˜¾ç¤ºç‚¹çš„åæ ‡æ ‡ç­¾
   - åŠ¨æ€æ˜¾ç¤ºå½“å‰é¼ æ ‡ä½ç½®çš„æ•°æ®å€¼

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **Qt æ–‡æ¡£**ï¼š
  - [QChart](https://doc.qt.io/qt-6/qchart.html)
  - [QLineSeries](https://doc.qt.io/qt-6/qlineseries.html)
  - [QValueAxis](https://doc.qt.io/qt-6/qvalueaxis.html)
  - [QPainter](https://doc.qt.io/qt-6/qpainter.html)

- **é¡¹ç›®æ–‡æ¡£**ï¼š
  - `è®¾è®¡å›¾/complete_class_diagram.puml` - å®Œæ•´ç±»å›¾
  - `è®¾è®¡æ–‡æ¡£/æ’¤é”€é‡åšåŠŸèƒ½å®ç°æ–‡æ¡£.md` - Command æ¨¡å¼å‚è€ƒ

- **æ•°å€¼ç§¯åˆ†**ï¼š
  - [æ¢¯å½¢æ³•åˆ™ï¼ˆTrapezoidal Ruleï¼‰](https://en.wikipedia.org/wiki/Trapezoidal_rule)

---

## âœ… éªŒæ”¶æ ‡å‡†

å®Œæˆä»¥ä¸‹æ‰€æœ‰åŠŸèƒ½å³ä¸ºéªŒæ”¶é€šè¿‡ï¼š

1. âœ… ç‚¹å‡»"å³°é¢ç§¯è®¡ç®—"æŒ‰é’®ï¼Œèƒ½å¤Ÿåœ¨æ›²çº¿ä¸Šé€‰æ‹©ä¸¤ä¸ªç‚¹å¹¶è®¡ç®—é¢ç§¯
2. âœ… å³°é¢ç§¯è®¡ç®—ç»“æœæ­£ç¡®ï¼ˆä¸æ‰‹å·¥è®¡ç®—è¯¯å·® < 1%ï¼‰
3. âœ… ç‚¹å‡»"ç»˜åˆ¶åŸºçº¿"æŒ‰é’®ï¼Œèƒ½å¤Ÿåœ¨æ›²çº¿ä¸Šé€‰æ‹©ä¸¤ä¸ªç‚¹å¹¶ç»˜åˆ¶ç›´çº¿
4. âœ… åŸºçº¿ç»˜åˆ¶æ”¯æŒæ’¤é”€ï¼ˆCtrl+Zï¼‰å’Œé‡åšï¼ˆCtrl+Yï¼‰
5. âœ… ç‚¹æ‹¾å–è¿‡ç¨‹ä¸­å¯ä»¥å–æ¶ˆæ“ä½œ
6. âœ… åœ¨æ²¡æœ‰æ›²çº¿æ—¶ç‚¹å‡»æŒ‰é’®ï¼Œç»™å‡ºå‹å¥½çš„æç¤º
7. âœ… åœ¨ä¸åŒæ›²çº¿ä¸Šç‚¹å‡»æ—¶ï¼Œç»™å‡ºè­¦å‘Šæç¤º
8. âœ… ä»£ç ç¼–è¯‘æ— è­¦å‘Šã€æ— é”™è¯¯
9. âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ä»£ç é£æ ¼**ï¼šéµå¾ªé¡¹ç›®ç°æœ‰çš„ä»£ç é£æ ¼ï¼ˆç±»ä¼¼ Qt é£æ ¼ï¼‰
2. **å†…å­˜ç®¡ç†**ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæˆ– Qt çš„çˆ¶å­å¯¹è±¡ç®¡ç†æœºåˆ¶
3. **ä¿¡å·å®‰å…¨**ï¼šç¡®ä¿å¯¹è±¡é”€æ¯å‰æ–­å¼€æ‰€æœ‰ä¿¡å·è¿æ¥
4. **åæ ‡è½¬æ¢**ï¼šæ³¨æ„æ•°æ®åæ ‡å’Œå±å¹•åæ ‡çš„è½¬æ¢
5. **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ‰€æœ‰ç”¨æˆ·å¯è§å­—ç¬¦ä¸²ä½¿ç”¨ tr()
6. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ å¿…è¦çš„ç©ºæŒ‡é’ˆæ£€æŸ¥å’Œè¾¹ç•Œæ£€æŸ¥
7. **æ—¥å¿—è®°å½•**ï¼šå…³é”®æ“ä½œä½¿ç”¨ qDebug() è¾“å‡ºæ—¥å¿—

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025-11-02
**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š2025-11-04ï¼ˆ2 ä¸ªå·¥ä½œæ—¥ï¼‰
**è´Ÿè´£äºº**ï¼šClaude Code
**ç‰ˆæœ¬**ï¼šv1.0
