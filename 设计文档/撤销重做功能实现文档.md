# æ’¤é”€/é‡åšåŠŸèƒ½å®ç°æ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
- [å…³é”®å®ç°ç»†èŠ‚](#å…³é”®å®ç°ç»†èŠ‚)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)

---

## æ¦‚è¿°

### åŠŸèƒ½æè¿°
æ’¤é”€/é‡åšåŠŸèƒ½å…è®¸ç”¨æˆ·æ’¤é”€ç®—æ³•æ“ä½œï¼ˆå¾®åˆ†ã€ç§¯åˆ†ã€ç§»åŠ¨å¹³å‡ç­‰ï¼‰ï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡åšè¿™äº›æ“ä½œã€‚è¯¥åŠŸèƒ½åŸºäº**å‘½ä»¤æ¨¡å¼**ï¼ˆCommand Patternï¼‰å®ç°ï¼Œå®Œå…¨ç¬¦åˆé¡¹ç›®çš„ DDD å››å±‚æ¶æ„è®¾è®¡ã€‚

### è®¾è®¡ç›®æ ‡
- âœ… **å®Œæ•´çš„æ’¤é”€/é‡åšæ”¯æŒ** - ç”¨æˆ·å¯ä»¥æ’¤é”€å’Œé‡åšå¤šæ¬¡ç®—æ³•æ“ä½œ
- âœ… **ç¬¦åˆæ¶æ„å›¾è®¾è®¡** - ä¸¥æ ¼æŒ‰ç…§ `ç®€åŒ–æ¶æ„å›¾.puml` ä¸­çš„è®¾è®¡å®ç°
- âœ… **æ˜“äºæ‰©å±•** - æ–°çš„å¯æ’¤é”€æ“ä½œåªéœ€å®ç° `ICommand` æ¥å£
- âœ… **å†…å­˜ç®¡ç†** - å†å²æ·±åº¦é™åˆ¶ï¼Œé˜²æ­¢å†…å­˜æ— é™å¢é•¿
- âœ… **UIå“åº”** - è‡ªåŠ¨å¯ç”¨/ç¦ç”¨æ’¤é”€/é‡åšæŒ‰é’®ï¼Œæä¾›å¿«æ·é”®æ”¯æŒ

### æ¶æ„ä½ç½®
```
é¢†åŸŸå±‚ (Domain Layer)
  â””â”€ ICommand æ¥å£
åº”ç”¨å±‚ (Application Layer)
  â”œâ”€ HistoryManager (å†å²ç®¡ç†å™¨)
  â””â”€ AlgorithmCommand (ç®—æ³•å‘½ä»¤å®ç°)
è¡¨ç¤ºå±‚ (Presentation Layer)
  â””â”€ MainWindow (UIé›†æˆ)
```

---

## æ¶æ„è®¾è®¡

### è®¾è®¡æ¨¡å¼ï¼šå‘½ä»¤æ¨¡å¼ (Command Pattern)

å‘½ä»¤æ¨¡å¼å°†"è¯·æ±‚"å°è£…ä¸ºå¯¹è±¡ï¼Œä»è€Œä½¿ç”¨æˆ·å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‘½ä»¤æ¨¡å¼ç»“æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ICommand (æ¥å£)                                              â”‚
â”‚  â”œâ”€ execute()  : æ‰§è¡Œå‘½ä»¤                                     â”‚
â”‚  â”œâ”€ undo()     : æ’¤é”€å‘½ä»¤                                     â”‚
â”‚  â”œâ”€ redo()     : é‡åšå‘½ä»¤                                     â”‚
â”‚  â””â”€ description() : å‘½ä»¤æè¿°                                  â”‚
â”‚                                                               â”‚
â”‚  HistoryManager (ç®¡ç†å™¨)                                      â”‚
â”‚  â”œâ”€ undoStack : æ’¤é”€æ ˆ                                        â”‚
â”‚  â”œâ”€ redoStack : é‡åšæ ˆ                                        â”‚
â”‚  â””â”€ executeCommand() : æ‰§è¡Œå¹¶è®°å½•å‘½ä»¤                         â”‚
â”‚                                                               â”‚
â”‚  AlgorithmCommand (å…·ä½“å‘½ä»¤)                                  â”‚
â”‚  â””â”€ å®ç° ICommand æ¥å£                                        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ
    â†“
MainWindow (UIå±‚)
    â†“
MainController (æ§åˆ¶å™¨)
    â†“
åˆ›å»º AlgorithmCommand
    â†“
HistoryManager.executeCommand()
    â†“
    â”œâ”€ execute() â†’ åˆ›å»ºæ–°æ›²çº¿
    â”œâ”€ æ·»åŠ åˆ° undoStack
    â””â”€ æ¸…ç©º redoStack

æ’¤é”€æ“ä½œ
    â†“
HistoryManager.undo()
    â†“
    â”œâ”€ ä» undoStack å¼¹å‡ºå‘½ä»¤
    â”œâ”€ command.undo() â†’ åˆ é™¤æ›²çº¿
    â””â”€ ç§»åŠ¨å‘½ä»¤åˆ° redoStack

é‡åšæ“ä½œ
    â†“
HistoryManager.redo()
    â†“
    â”œâ”€ ä» redoStack å¼¹å‡ºå‘½ä»¤
    â”œâ”€ command.redo() â†’ é‡æ–°æ·»åŠ æ›²çº¿
    â””â”€ ç§»åŠ¨å‘½ä»¤å› undoStack
```

---

## æ ¸å¿ƒç»„ä»¶

### 1. ICommand æ¥å£ï¼ˆé¢†åŸŸå±‚ï¼‰

**æ–‡ä»¶ä½ç½®**: `src/domain/algorithm/ICommand.h`

```cpp
class ICommand
{
public:
    virtual ~ICommand() = default;

    // æ‰§è¡Œå‘½ä»¤
    virtual bool execute() = 0;

    // æ’¤é”€å‘½ä»¤
    virtual bool undo() = 0;

    // é‡åšå‘½ä»¤ï¼ˆé»˜è®¤å®ç°ä¸ºå†æ¬¡æ‰§è¡Œï¼‰
    virtual bool redo() { return execute(); }

    // è¿”å›å‘½ä»¤æè¿°ï¼ˆç”¨äºæ—¥å¿—å’ŒUIæ˜¾ç¤ºï¼‰
    virtual QString description() const = 0;

    // åˆ¤æ–­å‘½ä»¤æ˜¯å¦å¯ä»¥è¢«æ’¤é”€
    virtual bool canUndo() const { return true; }
};
```

**è®¾è®¡è¦ç‚¹**ï¼š
- çº¯è™šæ¥å£ï¼Œå®šä¹‰å‘½ä»¤çš„æ ‡å‡†è¡Œä¸º
- æ‰€æœ‰å¯æ’¤é”€çš„æ“ä½œéƒ½å¿…é¡»å®ç°æ­¤æ¥å£
- `redo()` æä¾›é»˜è®¤å®ç°ï¼Œå­ç±»å¯é€‰æ‹©æ€§è¦†ç›–ä»¥ä¼˜åŒ–æ€§èƒ½

---

### 2. HistoryManagerï¼ˆåº”ç”¨å±‚ï¼‰

**æ–‡ä»¶ä½ç½®**: `src/application/history/HistoryManager.h/cpp`

```cpp
class HistoryManager : public QObject
{
    Q_OBJECT

public:
    // å•ä¾‹æ¨¡å¼
    static HistoryManager& instance(QObject *parent = nullptr);

    // æ‰§è¡Œå‘½ä»¤å¹¶æ·»åŠ åˆ°å†å²è®°å½•
    bool executeCommand(std::unique_ptr<ICommand> command);

    // æ’¤é”€æœ€è¿‘çš„å‘½ä»¤
    bool undo();

    // é‡åšæœ€è¿‘è¢«æ’¤é”€çš„å‘½ä»¤
    bool redo();

    // æŸ¥è¯¢çŠ¶æ€
    bool canUndo() const;
    bool canRedo() const;
    int undoCount() const;
    int redoCount() const;

    // é…ç½®
    void setHistoryLimit(int limit);
    int historyLimit() const;
    void clear();

signals:
    // å†å²çŠ¶æ€æ”¹å˜æ—¶å‘å°„ï¼ˆç”¨äºæ›´æ–°UIï¼‰
    void historyChanged();

private:
    std::vector<std::unique_ptr<ICommand>> m_undoStack;  // æ’¤é”€æ ˆ
    std::vector<std::unique_ptr<ICommand>> m_redoStack;  // é‡åšæ ˆ
    int m_historyLimit;  // å†å²è®°å½•æœ€å¤§æ·±åº¦ï¼ˆé»˜è®¤50ï¼‰
};
```

**å…³é”®ç‰¹æ€§**ï¼š
1. **å•ä¾‹æ¨¡å¼** - å…¨å±€å”¯ä¸€çš„å†å²ç®¡ç†å™¨å®ä¾‹
2. **æ™ºèƒ½æŒ‡é’ˆç®¡ç†** - ä½¿ç”¨ `std::unique_ptr` è‡ªåŠ¨ç®¡ç†å‘½ä»¤å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
3. **åŒæ ˆç»“æ„** - æ’¤é”€æ ˆå’Œé‡åšæ ˆåˆ†åˆ«ç®¡ç†å†å²è®°å½•
4. **å†å²æ·±åº¦é™åˆ¶** - é˜²æ­¢å†…å­˜æ— é™å¢é•¿
5. **ä¿¡å·é€šçŸ¥** - å†å²çŠ¶æ€æ”¹å˜æ—¶è‡ªåŠ¨é€šçŸ¥UIæ›´æ–°

**å†…å­˜ç®¡ç†ç­–ç•¥**ï¼š
```cpp
// æ‰§è¡Œæ–°å‘½ä»¤æ—¶
executeCommand() {
    undoStack.push_back(command);  // æ·»åŠ åˆ°æ’¤é”€æ ˆ
    redoStack.clear();             // æ¸…ç©ºé‡åšæ ˆï¼ˆå†å²åˆ†æ”¯å¤±æ•ˆï¼‰
    enforceHistoryLimit();         // é™åˆ¶æ ˆå¤§å°
}

// æ’¤é”€æ—¶
undo() {
    command = undoStack.pop_back();
    command->undo();
    redoStack.push_back(command);  // ç§»åˆ°é‡åšæ ˆ
}

// é‡åšæ—¶
redo() {
    command = redoStack.pop_back();
    command->redo();
    undoStack.push_back(command);  // ç§»å›æ’¤é”€æ ˆ
}
```

---

### 3. AlgorithmCommandï¼ˆåº”ç”¨å±‚ï¼‰

**æ–‡ä»¶ä½ç½®**: `src/application/history/AlgorithmCommand.h/cpp`

```cpp
class AlgorithmCommand : public ICommand
{
public:
    AlgorithmCommand(IThermalAlgorithm* algorithm,
                     ThermalCurve* inputCurve,
                     CurveManager* curveManager,
                     const QString& algorithmName);

    bool execute() override;
    bool undo() override;
    bool redo() override;
    QString description() const override;

private:
    IThermalAlgorithm* m_algorithm;      // ç®—æ³•æŒ‡é’ˆ
    ThermalCurve* m_inputCurve;          // è¾“å…¥æ›²çº¿
    CurveManager* m_curveManager;        // æ›²çº¿ç®¡ç†å™¨
    QString m_algorithmName;             // ç®—æ³•åç§°

    QString m_newCurveId;                // æ–°åˆ›å»ºçš„æ›²çº¿ID
    ThermalCurve m_newCurveData;         // æ–°æ›²çº¿çš„å®Œæ•´æ•°æ®ï¼ˆç”¨äºé‡åšï¼‰
    bool m_executed;                     // æ˜¯å¦å·²æ‰§è¡Œ
};
```

**å®ç°ç­–ç•¥**ï¼š

#### execute() - åˆ›å»ºæ–°æ›²çº¿
```cpp
bool AlgorithmCommand::execute()
{
    // 1. æ‰§è¡Œç®—æ³•å¤„ç†
    outputData = m_algorithm->process(m_inputCurve->getProcessedData());

    // 2. åˆ›å»ºæ–°æ›²çº¿
    m_newCurveId = QUuid::createUuid().toString();
    m_newCurveData = ThermalCurve(m_newCurveId, m_algorithm->displayName());

    // 3. å¡«å……æ›²çº¿æ•°æ®å’Œå…ƒæ•°æ®
    m_newCurveData.setProcessedData(outputData);
    m_newCurveData.setParentId(m_inputCurve->id());
    // ... è®¾ç½®å…¶ä»–å±æ€§

    // 4. æ·»åŠ åˆ° CurveManager
    m_curveManager->addCurve(m_newCurveData);
    m_curveManager->setActiveCurve(m_newCurveId);

    m_executed = true;
    return true;
}
```

#### undo() - åˆ é™¤æ–°æ›²çº¿
```cpp
bool AlgorithmCommand::undo()
{
    // ä» CurveManager åˆ é™¤æ–°åˆ›å»ºçš„æ›²çº¿
    return m_curveManager->removeCurve(m_newCurveId);
}
```

#### redo() - é‡æ–°æ·»åŠ æ›²çº¿
```cpp
bool AlgorithmCommand::redo()
{
    // ä½¿ç”¨ç¼“å­˜çš„æ•°æ®é‡æ–°æ·»åŠ æ›²çº¿ï¼ˆé¿å…é‡æ–°è®¡ç®—ï¼‰
    m_curveManager->addCurve(m_newCurveData);
    m_curveManager->setActiveCurve(m_newCurveId);
    return true;
}
```

**ä¼˜åŒ–äº®ç‚¹**ï¼š
- âœ… **ç¼“å­˜ç®—æ³•ç»“æœ** - `m_newCurveData` ä¿å­˜å®Œæ•´æ›²çº¿æ•°æ®ï¼Œé‡åšæ—¶æ— éœ€é‡æ–°è®¡ç®—
- âœ… **ä¿æŒIDä¸€è‡´** - æ’¤é”€åé‡åšï¼Œæ›²çº¿IDä¿æŒä¸å˜
- âœ… **è‡ªåŠ¨UIæ›´æ–°** - é€šè¿‡ CurveManager çš„ä¿¡å·è‡ªåŠ¨è§¦å‘UIåˆ·æ–°

---

### 4. UIé›†æˆï¼ˆè¡¨ç¤ºå±‚ï¼‰

**æ–‡ä»¶ä½ç½®**: `src/ui/mainwindow.cpp`

#### åˆ›å»ºæ’¤é”€/é‡åšæŒ‰é’®

```cpp
QToolBar *MainWindow::createFileToolBar()
{
    // ...

    // åˆ›å»ºæ’¤é”€æŒ‰é’®
    m_undoAction = toolbar->addAction(
        this->style()->standardIcon(QStyle::SP_ArrowBack),
        tr("æ’¤é”€")
    );
    m_undoAction->setShortcut(QKeySequence::Undo);  // Ctrl+Z
    m_undoAction->setShortcutContext(Qt::ApplicationShortcut);
    m_undoAction->setEnabled(false);
    this->addAction(m_undoAction);  // æ·»åŠ åˆ°çª—å£ä»¥å…¨å±€å¯ç”¨

    // åˆ›å»ºé‡åšæŒ‰é’®
    m_redoAction = toolbar->addAction(
        this->style()->standardIcon(QStyle::SP_ArrowForward),
        tr("é‡åš")
    );
    m_redoAction->setShortcut(QKeySequence::Redo);  // Ctrl+Y
    m_redoAction->setShortcutContext(Qt::ApplicationShortcut);
    m_redoAction->setEnabled(false);
    this->addAction(m_redoAction);

    return toolbar;
}
```

#### è¿æ¥ä¿¡å·å’Œæ›´æ–°UIçŠ¶æ€

```cpp
void MainWindow::initComponents()
{
    // è¿æ¥æŒ‰é’®åˆ°æ§åˆ¶å™¨
    connect(m_undoAction, &QAction::triggered,
            m_mainController, &MainController::onUndo);
    connect(m_redoAction, &QAction::triggered,
            m_mainController, &MainController::onRedo);

    // ç›‘å¬å†å²çŠ¶æ€å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°æŒ‰é’®çŠ¶æ€
    connect(&HistoryManager::instance(), &HistoryManager::historyChanged,
            this, [this]() {
        HistoryManager& historyManager = HistoryManager::instance();
        m_undoAction->setEnabled(historyManager.canUndo());
        m_redoAction->setEnabled(historyManager.canRedo());
    });
}
```

**UIç‰¹æ€§**ï¼š
- âœ… **å¿«æ·é”®æ”¯æŒ** - Ctrl+Z (æ’¤é”€), Ctrl+Y (é‡åš)
- âœ… **åº”ç”¨ç¨‹åºçº§åˆ«** - å¿«æ·é”®åœ¨ä»»ä½•ç„¦ç‚¹çŠ¶æ€ä¸‹éƒ½å¯ç”¨
- âœ… **åŠ¨æ€å¯ç”¨/ç¦ç”¨** - æ ¹æ®å†å²çŠ¶æ€è‡ªåŠ¨æ›´æ–°æŒ‰é’®
- âœ… **æ ‡å‡†å›¾æ ‡** - ä½¿ç”¨ç³»ç»Ÿæ ‡å‡†çš„åé€€/å‰è¿›å›¾æ ‡

---

## å·¥ä½œæµç¨‹

### æ‰§è¡Œç®—æ³•æµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant MainWindow
    participant MainController
    participant AlgorithmCommand
    participant HistoryManager
    participant CurveManager

    User->>MainWindow: ç‚¹å‡»"å¾®åˆ†"æŒ‰é’®
    MainWindow->>MainController: onAlgorithmRequested("differentiation")
    MainController->>AlgorithmCommand: new AlgorithmCommand(...)
    MainController->>HistoryManager: executeCommand(command)
    HistoryManager->>AlgorithmCommand: execute()
    AlgorithmCommand->>CurveManager: addCurve(newCurve)
    CurveManager-->>MainWindow: curveAdded ä¿¡å·
    MainWindow-->>User: æ˜¾ç¤ºæ–°æ›²çº¿
    HistoryManager->>HistoryManager: undoStack.push_back(command)
    HistoryManager->>HistoryManager: redoStack.clear()
    HistoryManager-->>MainWindow: historyChanged ä¿¡å·
    MainWindow-->>User: å¯ç”¨"æ’¤é”€"æŒ‰é’®
```

### æ’¤é”€æµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant MainWindow
    participant MainController
    participant HistoryManager
    participant AlgorithmCommand
    participant CurveManager

    User->>MainWindow: æŒ‰ Ctrl+Z
    MainWindow->>MainController: onUndo()
    MainController->>HistoryManager: undo()
    HistoryManager->>HistoryManager: command = undoStack.pop_back()
    HistoryManager->>AlgorithmCommand: undo()
    AlgorithmCommand->>CurveManager: removeCurve(curveId)
    CurveManager-->>MainWindow: curveRemoved ä¿¡å·
    MainWindow-->>User: ç§»é™¤æ›²çº¿æ˜¾ç¤º
    HistoryManager->>HistoryManager: redoStack.push_back(command)
    HistoryManager-->>MainWindow: historyChanged ä¿¡å·
    MainWindow-->>User: å¯ç”¨"é‡åš"æŒ‰é’®
```

### é‡åšæµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant MainWindow
    participant MainController
    participant HistoryManager
    participant AlgorithmCommand
    participant CurveManager

    User->>MainWindow: æŒ‰ Ctrl+Y
    MainWindow->>MainController: onRedo()
    MainController->>HistoryManager: redo()
    HistoryManager->>HistoryManager: command = redoStack.pop_back()
    HistoryManager->>AlgorithmCommand: redo()
    AlgorithmCommand->>CurveManager: addCurve(cachedData)
    CurveManager-->>MainWindow: curveAdded ä¿¡å·
    MainWindow-->>User: é‡æ–°æ˜¾ç¤ºæ›²çº¿
    HistoryManager->>HistoryManager: undoStack.push_back(command)
    HistoryManager-->>MainWindow: historyChanged ä¿¡å·
    MainWindow-->>User: æ›´æ–°æŒ‰é’®çŠ¶æ€
```

---

## å…³é”®å®ç°ç»†èŠ‚

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨ std::vector è€Œä¸æ˜¯ QStackï¼Ÿ

**é—®é¢˜**ï¼šQt çš„ QStack ä¸æ”¯æŒ `std::unique_ptr`
```cpp
// ç¼–è¯‘é”™è¯¯ï¼
QStack<std::unique_ptr<ICommand>> m_undoStack;
```

**åŸå› **ï¼š
- QStack åŸºäº QVectorï¼Œåœ¨å†…éƒ¨æ“ä½œä¸­ä¼šå°è¯•æ‹·è´å…ƒç´ 
- `std::unique_ptr` ç¦æ­¢æ‹·è´ï¼Œåªèƒ½ç§»åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `std::vector` æ¨¡æ‹Ÿæ ˆ
```cpp
std::vector<std::unique_ptr<ICommand>> m_undoStack;

// å…¥æ ˆ
m_undoStack.push_back(std::move(command));

// å‡ºæ ˆ
auto command = std::move(m_undoStack.back());
m_undoStack.pop_back();
```

---

### 2. å†å²æ·±åº¦é™åˆ¶å®ç°

**ç›®æ ‡**ï¼šé˜²æ­¢å†å²è®°å½•æ— é™å¢é•¿ï¼Œå¯¼è‡´å†…å­˜æº¢å‡º

```cpp
void HistoryManager::enforceHistoryLimit()
{
    // å¦‚æœæ’¤é”€æ ˆè¶…è¿‡é™åˆ¶ï¼Œç§»é™¤æœ€æ—§çš„å‘½ä»¤ï¼ˆä»å¼€å¤´ç§»é™¤ï¼‰
    while (static_cast<int>(m_undoStack.size()) > m_historyLimit) {
        m_undoStack.erase(m_undoStack.begin());
    }
}
```

**é…ç½®**ï¼š
- é»˜è®¤é™åˆ¶ï¼š50 æ­¥
- å¯é€šè¿‡ `setHistoryLimit()` è°ƒæ•´
- åªé™åˆ¶æ’¤é”€æ ˆï¼Œé‡åšæ ˆä¸éœ€è¦é™åˆ¶ï¼ˆæ‰§è¡Œæ–°å‘½ä»¤æ—¶ä¼šæ¸…ç©ºï¼‰

---

### 3. ä¸ºä»€ä¹ˆæ’¤é”€/é‡åšä¸ç›´æ¥ä¿®æ”¹ç°æœ‰æ›²çº¿ï¼Ÿ

**è®¾è®¡å†³ç­–**ï¼šåˆ›å»ºæ–°æ›²çº¿ vs ä¿®æ”¹ç°æœ‰æ›²çº¿

#### æœ€åˆè®¾è®¡ï¼ˆæœ‰é—®é¢˜ï¼‰
```cpp
execute() {
    // ä¿®æ”¹ç°æœ‰æ›²çº¿
    m_curve->setProcessedData(newData);
}

undo() {
    // æ¢å¤æ—§æ•°æ®
    m_curve->setProcessedData(oldData);
}
```

**é—®é¢˜**ï¼š
- âŒ ç”¨æˆ·æœŸæœ›ç®—æ³•ç”Ÿæˆ**æ–°æ›²çº¿**ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸæ›²çº¿
- âŒ åŸå§‹æ•°æ®å’Œç®—æ³•ç»“æœåº”è¯¥åˆ†å¼€æ˜¾ç¤º
- âŒ ä¸åŸæœ‰ AlgorithmService çš„è¡Œä¸ºä¸ä¸€è‡´

#### å½“å‰è®¾è®¡ï¼ˆæ­£ç¡®ï¼‰
```cpp
execute() {
    // åˆ›å»ºæ–°æ›²çº¿
    m_curveManager->addCurve(newCurve);
}

undo() {
    // åˆ é™¤æ–°æ›²çº¿
    m_curveManager->removeCurve(newCurveId);
}

redo() {
    // é‡æ–°æ·»åŠ æ›²çº¿ï¼ˆä½¿ç”¨ç¼“å­˜æ•°æ®ï¼‰
    m_curveManager->addCurve(m_newCurveData);
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç¬¦åˆç”¨æˆ·æœŸæœ›
- âœ… ä¿ç•™åŸå§‹æ›²çº¿å’Œç®—æ³•ç»“æœ
- âœ… ä¸æ¶æ„è®¾è®¡ä¸€è‡´
- âœ… æ”¯æŒçˆ¶å­æ›²çº¿å…³ç³»

---

### 4. å¿«æ·é”®å…¨å±€å¯ç”¨çš„å®ç°

**é—®é¢˜**ï¼šé»˜è®¤å¿«æ·é”®åªåœ¨ç‰¹å®šç„¦ç‚¹çŠ¶æ€ä¸‹å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```cpp
// 1. è®¾ç½®å¿«æ·é”®ä¸Šä¸‹æ–‡ä¸ºåº”ç”¨ç¨‹åºçº§åˆ«
m_undoAction->setShortcutContext(Qt::ApplicationShortcut);

// 2. å°† Action æ·»åŠ åˆ° MainWindow
this->addAction(m_undoAction);
```

**æ•ˆæœ**ï¼š
- æ— è®ºç„¦ç‚¹åœ¨å›¾è¡¨ã€æ ‘å½¢è§†å›¾è¿˜æ˜¯å…¶ä»–æ§ä»¶ï¼Œå¿«æ·é”®éƒ½èƒ½å“åº”
- ç”¨æˆ·ä½“éªŒä¸ä¸»æµåº”ç”¨ä¸€è‡´

---

### 5. Lambda æ•è·çš„æ³¨æ„äº‹é¡¹

**é—®é¢˜ä»£ç **ï¼ˆå¯èƒ½å¯¼è‡´æ‚¬ç©ºå¼•ç”¨ï¼‰ï¼š
```cpp
HistoryManager& historyManager = HistoryManager::instance();
connect(&historyManager, ..., [this, &historyManager]() {
    // æ•è·å±€éƒ¨å˜é‡å¼•ç”¨ï¼Œå¯èƒ½å¯¼è‡´é—®é¢˜
    m_undoAction->setEnabled(historyManager.canUndo());
});
```

**æ­£ç¡®ä»£ç **ï¼š
```cpp
connect(&HistoryManager::instance(), ..., [this]() {
    // åœ¨ lambda å†…éƒ¨è·å–å•ä¾‹å®ä¾‹ï¼Œæ›´å®‰å…¨
    HistoryManager& historyManager = HistoryManager::instance();
    m_undoAction->setEnabled(historyManager.canUndo());
});
```

**åŸå› **ï¼š
- å•ä¾‹å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸé•¿äºè¿æ¥
- é¿å…æ•è·å±€éƒ¨å¼•ç”¨å˜é‡
- æ›´æ¸…æ™°çš„æ„å›¾è¡¨è¾¾

---

## ä½¿ç”¨æŒ‡å—

### ç”¨æˆ·æ“ä½œ

#### åŸºæœ¬æ“ä½œ
1. **å¯¼å…¥æ•°æ®** - ä½¿ç”¨"å¯¼å…¥æ•°æ®"æŒ‰é’®åŠ è½½çƒ­åˆ†ææ•°æ®æ–‡ä»¶
2. **æ‰§è¡Œç®—æ³•** - åœ¨"çƒ­åŠ›å­¦"Tab ä¸­ç‚¹å‡»ç®—æ³•æŒ‰é’®ï¼ˆå¾®åˆ†/ç§¯åˆ†/ç§»åŠ¨å¹³å‡ï¼‰
3. **æ’¤é”€æ“ä½œ** - ç‚¹å‡»æ’¤é”€æŒ‰é’®æˆ–æŒ‰ **Ctrl+Z**
4. **é‡åšæ“ä½œ** - ç‚¹å‡»é‡åšæŒ‰é’®æˆ–æŒ‰ **Ctrl+Y** (Windows) / **Ctrl+Shift+Z** (Mac)

#### å…¸å‹ä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šå°è¯•ä¸åŒç®—æ³•**
```
1. å¯¼å…¥æ•°æ®
2. æ‰§è¡Œå¾®åˆ†ç®—æ³• â†’ ç”Ÿæˆ"å¾®åˆ†"æ›²çº¿
3. è§‰å¾—ä¸æ»¡æ„ï¼ŒæŒ‰ Ctrl+Z æ’¤é”€ â†’ "å¾®åˆ†"æ›²çº¿æ¶ˆå¤±
4. æ‰§è¡Œç§»åŠ¨å¹³å‡ç®—æ³• â†’ ç”Ÿæˆ"æ»¤æ³¢"æ›²çº¿
5. æ•ˆæœä¸é”™ï¼Œç»§ç»­æ“ä½œ
```

**åœºæ™¯2ï¼šå¯¹æ¯”ç®—æ³•ç»“æœ**
```
1. å¯¼å…¥æ•°æ®
2. æ‰§è¡Œå¾®åˆ†ç®—æ³• â†’ ç”Ÿæˆ"å¾®åˆ†"æ›²çº¿
3. æ‰§è¡Œç§»åŠ¨å¹³å‡ç®—æ³•ï¼ˆå¯¹å¾®åˆ†æ›²çº¿ï¼‰ â†’ ç”Ÿæˆ"æ»¤æ³¢"æ›²çº¿
4. æŒ‰ Ctrl+Z æ’¤é”€æ»¤æ³¢ â†’ åªä¿ç•™å¾®åˆ†æ›²çº¿
5. æŒ‰ Ctrl+Y é‡åš â†’ æ»¤æ³¢æ›²çº¿é‡æ–°å‡ºç°
6. æ¥å›å¯¹æ¯”ï¼Œé€‰æ‹©æœ€ä½³ç»“æœ
```

**åœºæ™¯3ï¼šæ’¤é”€å¤šæ­¥æ“ä½œ**
```
1. å¯¼å…¥æ•°æ®
2. æ‰§è¡Œæ“ä½œ1 â†’ æ›²çº¿A
3. æ‰§è¡Œæ“ä½œ2 â†’ æ›²çº¿B
4. æ‰§è¡Œæ“ä½œ3 â†’ æ›²çº¿C
5. è¿ç»­æŒ‰ Ctrl+Z ä¸‰æ¬¡ â†’ å›åˆ°åˆå§‹çŠ¶æ€
6. è¿ç»­æŒ‰ Ctrl+Y ä¸‰æ¬¡ â†’ æ¢å¤æ‰€æœ‰æ“ä½œ
```

#### UIåé¦ˆ
- ğŸ“Œ **æŒ‰é’®çŠ¶æ€**ï¼š
  - ç°è‰²ç¦ç”¨ = æ— æ³•æ‰§è¡Œè¯¥æ“ä½œ
  - æ­£å¸¸æ˜¾ç¤º = å¯ä»¥æ‰§è¡Œè¯¥æ“ä½œ
- ğŸ“Œ **å¿«æ·é”®æç¤º**ï¼š
  - é¼ æ ‡æ‚¬åœåœ¨æŒ‰é’®ä¸Šå¯æŸ¥çœ‹å¿«æ·é”®
- ğŸ“Œ **å†å²æ·±åº¦**ï¼š
  - æœ€å¤šä¿ç•™ 50 æ­¥å†å²è®°å½•
  - è¶…è¿‡é™åˆ¶åï¼Œæœ€æ—©çš„æ“ä½œå°†è¢«é—å¿˜

---

## æ‰©å±•æŒ‡å—

### å¦‚ä½•æ·»åŠ æ–°çš„å¯æ’¤é”€æ“ä½œï¼Ÿ

å‡è®¾æ‚¨è¦æ·»åŠ "åŸºçº¿æ ¡æ­£"æ“ä½œçš„æ’¤é”€/é‡åšæ”¯æŒï¼š

#### æ­¥éª¤1ï¼šåˆ›å»ºå‘½ä»¤ç±»

```cpp
// src/application/history/BaselineCorrectionCommand.h
#include "domain/algorithm/ICommand.h"

class BaselineCorrectionCommand : public ICommand
{
public:
    BaselineCorrectionCommand(/* æ„é€ å‚æ•° */);

    bool execute() override {
        // æ‰§è¡ŒåŸºçº¿æ ¡æ­£
        // ...
        return true;
    }

    bool undo() override {
        // æ’¤é”€åŸºçº¿æ ¡æ­£
        // ...
        return true;
    }

    bool redo() override {
        // é‡åšåŸºçº¿æ ¡æ­£
        // ...
        return true;
    }

    QString description() const override {
        return "åŸºçº¿æ ¡æ­£æ“ä½œ";
    }

private:
    // ä¿å­˜å¿…è¦çš„æ•°æ®ä»¥æ”¯æŒæ’¤é”€/é‡åš
};
```

#### æ­¥éª¤2ï¼šåœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨

```cpp
// src/ui/controller/MainController.cpp
void MainController::onBaselineCorrection()
{
    // 1. è·å–æ´»åŠ¨æ›²çº¿
    ThermalCurve* activeCurve = m_curveManager->getActiveCurve();
    if (!activeCurve) return;

    // 2. åˆ›å»ºå‘½ä»¤
    auto command = std::make_unique<BaselineCorrectionCommand>(
        activeCurve, /* å…¶ä»–å‚æ•° */);

    // 3. æ‰§è¡Œå‘½ä»¤
    m_historyManager->executeCommand(std::move(command));
}
```

#### æ­¥éª¤3ï¼šæ›´æ–°é¡¹ç›®æ–‡ä»¶

```qmake
# Analysis.pro
HEADERS += src/application/history/BaselineCorrectionCommand.h
SOURCES += src/application/history/BaselineCorrectionCommand.cpp
```

### å‘½ä»¤è®¾è®¡æœ€ä½³å®è·µ

#### âœ… è‰¯å¥½è®¾è®¡
```cpp
class GoodCommand : public ICommand
{
private:
    // ä¿å­˜æŒ‡é’ˆï¼ˆä¸æ‹¥æœ‰ï¼‰
    ThermalCurve* m_curve;

    // ä¿å­˜å¿…è¦çš„çŠ¶æ€æ•°æ®
    QVector<ThermalDataPoint> m_oldData;
    QVector<ThermalDataPoint> m_newData;

    // æ ‡è®°æ‰§è¡ŒçŠ¶æ€
    bool m_executed;
};
```

#### âŒ é¿å…
```cpp
class BadCommand : public ICommand
{
private:
    // âŒ ä¸è¦ä¿å­˜å¤§é‡å†—ä½™æ•°æ®
    QVector<ThermalCurve> m_allCurves;

    // âŒ ä¸è¦åœ¨å‘½ä»¤ä¸­æ‰§è¡Œè€—æ—¶è®¡ç®—
    void heavyComputation() { /* ... */ }

    // âŒ ä¸è¦ä½¿ç”¨å…¨å±€å˜é‡
    static int globalState;
};
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. ç¼“å­˜é‡åšæ•°æ®
```cpp
bool AlgorithmCommand::execute()
{
    // æ‰§è¡Œç®—æ³•
    m_newData = algorithm->process(inputData);

    // ç¼“å­˜ç»“æœï¼Œé‡åšæ—¶ç›´æ¥ä½¿ç”¨
    m_newCurveData.setProcessedData(m_newData);

    return true;
}

bool AlgorithmCommand::redo()
{
    // ç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œä¸é‡æ–°è®¡ç®—
    m_curveManager->addCurve(m_newCurveData);
    return true;
}
```

#### 2. ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰
```cpp
// âœ… ä½¿ç”¨ std::move é¿å…æ‹·è´
m_historyManager->executeCommand(std::move(command));

// âŒ ä¸è¦æ‹·è´å¤§å¯¹è±¡
// m_historyManager->executeCommand(command);  // é”™è¯¯ï¼
```

#### 3. åˆç†è®¾ç½®å†å²æ·±åº¦
```cpp
// æ ¹æ®åº”ç”¨åœºæ™¯è°ƒæ•´
HistoryManager::instance().setHistoryLimit(100);  // å…è®¸æ›´å¤šå†å²

// æˆ–è€…é™ä½é™åˆ¶ä»¥èŠ‚çœå†…å­˜
HistoryManager::instance().setHistoryLimit(20);
```

---

## æ¶æ„ä¼˜åŠ¿

### 1. æ¾è€¦åˆè®¾è®¡
- ICommand æ¥å£ç‹¬ç«‹äºå…·ä½“å®ç°
- HistoryManager ä¸ä¾èµ–å…·ä½“çš„å‘½ä»¤ç±»å‹
- UI å±‚ä¸éœ€è¦äº†è§£å‘½ä»¤çš„å†…éƒ¨å®ç°

### 2. æ˜“äºæµ‹è¯•
```cpp
// å•å…ƒæµ‹è¯•ç¤ºä¾‹
TEST(HistoryManagerTest, UndoRedo)
{
    HistoryManager& manager = HistoryManager::instance();

    // åˆ›å»ºæ¨¡æ‹Ÿå‘½ä»¤
    auto command = std::make_unique<MockCommand>();

    // æµ‹è¯•æ‰§è¡Œ
    ASSERT_TRUE(manager.executeCommand(std::move(command)));
    ASSERT_TRUE(manager.canUndo());

    // æµ‹è¯•æ’¤é”€
    ASSERT_TRUE(manager.undo());
    ASSERT_TRUE(manager.canRedo());

    // æµ‹è¯•é‡åš
    ASSERT_TRUE(manager.redo());
}
```

### 3. ç¬¦åˆ SOLID åŸåˆ™
- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼ˆæ–°å‘½ä»¤ï¼‰ï¼Œå¯¹ä¿®æ”¹å°é—­
- **é‡Œæ°æ›¿æ¢**ï¼šæ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥æ›¿æ¢ä½¿ç”¨
- **æ¥å£éš”ç¦»**ï¼šICommand æ¥å£ç²¾ç®€
- **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡ï¼ˆICommandï¼‰è€Œéå…·ä½“å®ç°

### 4. å®Œå…¨éµå¾ªæ¶æ„å›¾
```
âœ… ICommand æ¥å£       â†’ é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰
âœ… HistoryManager      â†’ åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰
âœ… AlgorithmCommand    â†’ åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰
âœ… MainWindow é›†æˆ     â†’ è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰
```

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: ä¸ºä»€ä¹ˆæ’¤é”€åï¼Œæ›²çº¿çš„ ID ä¼šå˜åŒ–ï¼Ÿ
**A**: ä¸ä¼šå˜åŒ–ã€‚AlgorithmCommand ä¿å­˜äº†åŸå§‹çš„æ›²çº¿ ID (`m_newCurveId`)ï¼Œæ’¤é”€åé‡åšæ—¶ä¼šä½¿ç”¨ç›¸åŒçš„ IDã€‚

### Q2: å†å²è®°å½•ä¼šå ç”¨å¤šå°‘å†…å­˜ï¼Ÿ
**A**: æ¯ä¸ªå‘½ä»¤ä¿å­˜ä¸€æ¡æ›²çº¿çš„å®Œæ•´æ•°æ®ã€‚ä»¥é»˜è®¤é™åˆ¶ 50 æ­¥è®¡ç®—ï¼š
- æ¯æ¡æ›²çº¿çº¦ 1-10 MBï¼ˆå–å†³äºæ•°æ®ç‚¹æ•°é‡ï¼‰
- 50 æ¡æ›²çº¿æœ€å¤šçº¦ 500 MB
- å¯é€šè¿‡ `setHistoryLimit()` è°ƒæ•´é™åˆ¶

### Q3: å…³é—­ç¨‹åºåï¼Œå†å²è®°å½•ä¼šä¿å­˜å—ï¼Ÿ
**A**: ä¸ä¼šã€‚å½“å‰å®ç°çš„å†å²è®°å½•æ˜¯å†…å­˜ä¸­çš„ï¼Œç¨‹åºå…³é—­åä¼šä¸¢å¤±ã€‚å¦‚éœ€æŒä¹…åŒ–ï¼Œéœ€è¦å®ç°å†å²è®°å½•çš„åºåˆ—åŒ–ã€‚

### Q4: å¯ä»¥æ’¤é”€"å¯¼å…¥æ•°æ®"æ“ä½œå—ï¼Ÿ
**A**: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒã€‚åªæœ‰ç®—æ³•æ“ä½œå¯ä»¥æ’¤é”€ã€‚å¦‚éœ€æ”¯æŒï¼Œéœ€è¦åˆ›å»º `ImportDataCommand`ã€‚

### Q5: æ’¤é”€/é‡åšæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ
**A**: å½“å‰å®ç°å‡å®šæ‰€æœ‰æ“ä½œéƒ½åœ¨ UI çº¿ç¨‹ã€‚å¦‚æœéœ€è¦å¤šçº¿ç¨‹æ”¯æŒï¼Œéœ€è¦æ·»åŠ äº’æ–¥é”ä¿æŠ¤ã€‚

---

## æœªæ¥æ‰©å±•æ–¹å‘

### 1. æŒä¹…åŒ–å†å²è®°å½•
```cpp
// ä¿å­˜å†å²è®°å½•åˆ°æ–‡ä»¶
HistoryManager::instance().saveHistory("history.dat");

// ä»æ–‡ä»¶åŠ è½½å†å²è®°å½•
HistoryManager::instance().loadHistory("history.dat");
```

### 2. å†å²è®°å½•å¯è§†åŒ–
```cpp
// æ˜¾ç¤ºå†å²è®°å½•åˆ—è¡¨
QListWidget* historyList = new QListWidget();
for (int i = 0; i < manager.undoCount(); i++) {
    historyList->addItem(manager.getCommand(i)->description());
}
```

### 3. é€‰æ‹©æ€§æ’¤é”€
```cpp
// æ’¤é”€åˆ°ç‰¹å®šçš„å†å²ç‚¹
manager.undoTo(5);  // æ’¤é”€åˆ°ç¬¬5æ­¥

// è·³è¿‡æŸäº›å‘½ä»¤
manager.undo(skipCommand);
```

### 4. å®å‘½ä»¤æ”¯æŒ
```cpp
// å°†å¤šä¸ªå‘½ä»¤ç»„åˆä¸ºä¸€ä¸ª
MacroCommand macro;
macro.addCommand(command1);
macro.addCommand(command2);
manager.executeCommand(std::move(macro));
// æ’¤é”€æ—¶ï¼Œä¸€æ¬¡æ€§æ’¤é”€æ‰€æœ‰å­å‘½ä»¤
```

---

## æ€»ç»“

æ’¤é”€/é‡åšåŠŸèƒ½çš„å®ç°å®Œå…¨éµå¾ªäº†é¡¹ç›®çš„ DDD å››å±‚æ¶æ„è®¾è®¡ï¼Œé‡‡ç”¨**å‘½ä»¤æ¨¡å¼**å®ç°äº†çµæ´»ã€å¯æ‰©å±•çš„å†å²ç®¡ç†ç³»ç»Ÿã€‚ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š

âœ… **æ¶æ„æ¸…æ™°** - ä¸¥æ ¼éµå¾ªåˆ†å±‚æ¶æ„ï¼ŒèŒè´£æ˜ç¡®
âœ… **æ˜“äºæ‰©å±•** - æ–°æ“ä½œåªéœ€å®ç° ICommand æ¥å£
âœ… **æ€§èƒ½ä¼˜åŒ–** - ç¼“å­˜é‡åšæ•°æ®ï¼Œé¿å…é‡å¤è®¡ç®—
âœ… **ç”¨æˆ·å‹å¥½** - å¿«æ·é”®æ”¯æŒï¼Œè‡ªåŠ¨UIæ›´æ–°
âœ… **å†…å­˜å¯æ§** - å†å²æ·±åº¦é™åˆ¶ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º

è¯¥è®¾è®¡ä¸ä»…æ»¡è¶³å½“å‰éœ€æ±‚ï¼Œè¿˜ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•é¢„ç•™äº†å……è¶³çš„ç©ºé—´ã€‚

---

## å‚è€ƒèµ„æ–™

- **è®¾è®¡æ¨¡å¼**ï¼šã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹- Command Pattern
- **æ¶æ„è®¾è®¡**ï¼šé¡¹ç›®æ ¹ç›®å½• `è®¾è®¡å›¾/ç®€åŒ–æ¶æ„å›¾.puml`
- **Qt æ–‡æ¡£**ï¼š[QAction Class](https://doc.qt.io/qt-5/qaction.html)
- **C++ æ ‡å‡†åº“**ï¼š[std::unique_ptr](https://en.cppreference.com/w/cpp/memory/unique_ptr)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-02
**ä½œè€…**: Claude (Anthropic)
**é¡¹ç›®**: çƒ­åˆ†æè½¯ä»¶ - Analysis
